# CF1446D2

ç»™å®šä¸€ä¸ªæ•°ç»„ $ [a_1, a_2, \dots, a_n] $ ã€‚

æ‚¨çš„ç›®æ ‡æ˜¯æ‰¾åˆ°è¿™ä¸ªæ•°ç»„çš„æœ€é•¿å­æ•°ç»„çš„é•¿åº¦ï¼Œä½¿å¾—å…¶ä¸­æœ€é¢‘ç¹çš„å€¼**ä¸**æ˜¯å”¯ä¸€çš„ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨è¦æ‰¾åˆ°ä¸€ä¸ªå­æ•°ç»„ï¼Œä½¿å¾—å¦‚æžœè¿™ä¸ªå­æ•°ç»„ä¸­æœ€é¢‘ç¹çš„å€¼å‡ºçŽ° $ f $ æ¬¡ï¼Œé‚£ä¹ˆè‡³å°‘ä¼šæœ‰ $ 2 $ ä¸ªä¸åŒçš„å€¼æ°å¥½å‡ºçŽ° $ f $ æ¬¡ã€‚

å¦‚æžœ $ c $ æ˜¯æ•°ç»„ $ d $ çš„å­æ•°ç»„ï¼Œåˆ™ $ c $ å¯ä»¥é€šè¿‡ä»Žå¼€å¤´åˆ é™¤è‹¥å¹²ï¼ˆå¯èƒ½æ˜¯é›¶æˆ–å…¨éƒ¨ï¼‰å…ƒç´ å’Œä»Žç»“å°¾åˆ é™¤è‹¥å¹²ï¼ˆå¯èƒ½æ˜¯é›¶æˆ–å…¨éƒ¨ï¼‰å…ƒç´ æ¥èŽ·å¾—ã€‚

$n\le 2\times 10^5,a_i\le n$

### æ€è€ƒ

æœ‰ä»€ä¹ˆå¥½çš„åŠžæ³•åˆ¤æ–­ä¸€ä¸ªåŒºé—´æ˜¯å¦åˆæ³•å—ï¼Ÿè¿™ä¸ªä¼—æ•°è¿˜æ˜¯å¤ªæŠ½è±¡äº†

D1 ç‰ˆæœ¬çš„å€¼åŸŸæ˜¯ $100$ï¼Œè¿™æ„å‘³ç€åšæ³•å’Œå€¼åŸŸæœ‰å…³ï¼Œä¸ä¼šæœ‰æ²¡ç”¨çš„çº¦æŸã€‚

å¦‚æžœæˆ‘æžšä¸¾ä¼—æ•°çš„å‡ºçŽ°æ¬¡æ•° $x$

é‚£ä¹ˆå¯¹äºŽæ¯ä¸ªå€¼ï¼Œä½¿å¾—ä»–å‡ºçŽ° $x$ æ¬¡çš„åŒºé—´æ˜¯å¯ä»¥åˆ»ç”»çš„ï¼Œè‡³å°‘è¦åŒ…å«ä¸¤ä¸ªå€¼çš„åŒºé—´ã€‚

æœ‰ç‚¹å›°éš¾

å€¼åŸŸ 100 æ€Žä¹ˆåšï¼Ÿ

è¿˜æ˜¯å›°éš¾ï¼Œæƒ³ä¸åˆ°ä»€ä¹ˆæ€è·¯äº†

### é¢˜è§£	

éžå¸¸å…³é”®çš„ç»“è®ºï¼šè‹¥åŽŸåºåˆ—çš„ä¼—æ•°ä¸º $X$ï¼Œç­”æ¡ˆå­æ®µçš„ä¼—æ•°é›†åˆä¸€å®šå«æœ‰ $X$ã€‚

è¯æ˜Žæ˜¯ï¼Œè‹¥ç­”æ¡ˆå­æ®µçš„ä¼—æ•°ä¸å« $X$ï¼Œè¯´æ˜Žå­æ®µå†… $X$ çš„å‡ºçŽ°æ¬¡æ•°å°äºŽå­æ®µä¼—æ•°ã€‚é‚£ä¹ˆå¯ä»¥å‘ä¸¤ä¾§æ‹“å±•ï¼Œå®¹æ˜“è¯æ˜Žä¸€å®šèƒ½æ‹“å±•åˆ°ä¸€ä¸ªåˆæ³•çš„æ›´å¤§åŒºé—´ï¼Œæ»¡è¶³ $X$ æˆä¸ºå­æ®µçš„ä¼—æ•°ã€‚

äºŽæ˜¯çŽ°åœ¨å¯åšéžå¸¸å¤šï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå°½å¯èƒ½é•¿çš„å­æ®µï¼Œæ»¡è¶³ $X$ ä¸Žå¦ä¸€ä¸ªæ•°çš„å‡ºçŽ°æ¬¡æ•°ç›¸ç­‰ã€‚å¦‚æžœ $X$ ä¸çœŸçš„æ˜¯è¿™ä¸ªåŒºé—´çš„ä¼—æ•°æ˜¯æ²¡å…³ç³»çš„ï¼Œå› ä¸ºè¿™æ ·çš„åŒºé—´ä¸ä¼˜ï¼Œæ¢æˆ $X$ ä¸ŽçœŸæ­£çš„ä¼—æ•°å¯ä»¥å¾—åˆ°æ›´å¤§çš„ç­”æ¡ˆã€‚

äºŽæ˜¯çŽ°åœ¨æœ‰äº†ä¸€ä¸ªæžšä¸¾å€¼åŸŸçš„åšæ³•ã€‚å¯¹äºŽæ¯ä¸ªå€¼ $V$ï¼ŒæŠŠ $X$ çœ‹æˆ $+1$ï¼Œ$V$ çœ‹æˆ $-1$ï¼Œæ‰¾åŒºé—´å’Œä¸º $0$ çš„æœ€é•¿å­æ®µå³å¯ï¼Œéœ€è¦èŠ±è´¹ $O(occ(X)+occ(V))$ çš„æ—¶é—´ã€‚

æ³¨æ„åˆ°ï¼Œç¬¦åˆè¦æ±‚çš„å­æ®µåŒ…å«çš„ $X$ æ•°é‡æ˜¯å’Œ $V$ ç›¸ç­‰çš„ã€‚**å½“ $X$ çš„å‡ºçŽ°æ¬¡æ•°è¿œå¤šäºŽ $V$ æ—¶ï¼Œæžšä¸¾ $occ(X)$ æ˜¾å¾—æœ‰äº›æµªè´¹**ã€‚

å°è¯•åªä¿ç•™ $O(occ(V))$ ä¸ª $X$ å¹¶ä¸”ä¸å½±å“ç­”æ¡ˆã€‚è€ƒè™‘ $V$ ä¸Ž $X$ é…å¯¹ã€‚

- ä»Žå‰å¾€åŽéåŽ† $V$ï¼ŒæŠŠå®ƒä¸ŽåŽé¢ç¬¬ä¸€ä¸ª $X$ é…å¯¹ï¼Œåˆ åŽ» $X$
- ä»ŽåŽå¾€å‰éåŽ† $V$ï¼ŒæŠŠå®ƒä¸Žå‰é¢ç¬¬ä¸€ä¸ª $X$ é…å¯¹ï¼Œåˆ åŽ» $X$

æ˜¾ç„¶ $X$ çš„æ•°é‡ç¬¦åˆè¦æ±‚ï¼Œä¸”å¯ä»¥è¯æ˜Žï¼Œåªè€ƒè™‘è¢«é…å¯¹çš„ $X$ ç­”æ¡ˆä¸å˜ã€‚

>  å¯¹äºŽæœªè¢«é…å¯¹çš„ $X$ï¼Œå®ƒä¸€å®šä¸ä¼šåœ¨ç­”æ¡ˆä¸­å‡ºçŽ°ã€‚

å¯¹äºŽä¸€ä¸ªæœªè¢«é…å¯¹çš„ $X$ï¼Œæˆ‘ä»¬å‘åŽæ‹“å±•ï¼ˆå‘å‰åŒç†ï¼‰ï¼Œå¸Œæœ›æ‰¾åˆ°ä¸€ä¸ª $V$ èƒ½è´¡çŒ®ä¸€ä¸ª $-1$ ä½¿å¾—åŒºé—´å’Œä¸º $0$ã€‚ä½†å®ƒåŽé¢ä¸€å®šæ²¡æœ‰æœªå‘å‰é…å¯¹çš„ $V$ï¼Œå› æ­¤æ¯ä¸ª $V$ åœ¨è¢«è®¿é—®åˆ°ä¹‹å‰ï¼Œå®ƒçš„ $-1$ ä¸€å®šä»¥åŠè¢«å®ƒå‘å‰åŒ¹é…çš„ $X$ æŠµæ¶ˆæŽ‰äº†ã€‚

ç›´æŽ¥ç»´æŠ¤å³å¯ï¼Œå¤æ‚åº¦ $O(n\log n)$ã€‚ç²¾ç»†å®žçŽ°å¯ä»¥åšåˆ° $O(n)$ï¼Œä¸è¿‡æ²¡æœ‰å¿…è¦ã€‚

```
int n;
int a[MAXN];
int getX(){
	static int cnt[MAXN];
	foru(i,1,n){
		cnt[a[i]]++;
	}
	
	int mx=0,ct=0;
	ford(i,n,1){
		if(cnt[i]>mx){
			mx=cnt[i];
			ct=1;
		}else if(cnt[i]==mx){
			ct++;
		}
	}
	if(ct>1){
		cout<<n;
		exit(0);
	}

	foru(i,1,n){
		if(mx==cnt[i])	return i;
	}
	exit(1);
}
void solve(bool SPE){ 
	n=RIN;
	foru(i,1,n){
		a[i]=RIN;
	}

	int X=getX();
	cerr<<X<<endl;

	static vector<int> ls[MAXN];
	foru(i,1,n){
		ls[a[i]]+=i;
	}

	static set<int> xls;
	foru(i,1,n){
		if(a[i]==X)	xls+=i;
	}

	int ans=0;
	foru(v,1,n){
		if(ls[v].empty())	continue;
		if(v==X)	continue;

		static vector<int> p;
		static vector<int> rmv;
		
		p=ls[v];
		
		for(auto i:ls[v]){
			auto it=xls.lower_bound(i);
			if(it==xls.end())	break;
			rmv+=*it;
			p+=*it;
			xls.erase(it);
		}
		for(int i=ls[v].size()-1;i>=0;i--){
			auto it=xls.lower_bound(ls[v][i]);
			// cerr<<i<<' '<<*it<<endl;
			if(it==xls.begin())	break;
			it--;
			rmv+=*it;
			p+=*it;
			xls.erase(it);
		}
		sort(All(p));

		// cein<<p<<endl;

		for(size_t l=0;l<p.size();){
			size_t r=l;

			auto ptr=xls.lower_bound(p[l]);
			int lm=n+1;
			if(ptr!=xls.end())	lm=*ptr;
			while(r+1<p.size() && p[r+1]<lm)	r++;
			
			static unordered_map<int,int> bg;
			bg.clear();
			bg[0]=0;
			if(ptr!=xls.begin())	bg[0]=*prev(ptr);

			int s=0;
			for(size_t i=l;i<=r;i++){
				if(a[p[i]]==X){
					s++;
				}else{
					s--;
				}
				// cerr<<X<<' '<<v<<' '<<p[i]<<' '<<s<<endl;
				// cerr<<r<<' '<<i<<endl;
				auto it=bg.find(s);
				if(it!=bg.end()){
					int R=lm;
					if(i+1<=r)	R=p[i+1];
					// cerr<<R<<' '<<it->se<<endl;
					chkmax(ans,R-1-it->se);
				}else{
					bg[s]=p[i];
				}
			}

			l=r+1;
		}

		for(auto i:rmv){
			xls+=i;
		}
		rmv.clear();

		cerr<<"~"<<ans<<endl;
	}

	cout<<ans;
	return ;
}
```

# AT_agc016_e

æœ‰$N$åªç«é¸¡ã€‚æˆ‘ä»¬ç”¨$1$åˆ°$N$å¯¹å®ƒä»¬ç¼–å·ã€‚

$M$ä¸ªäººå°†ä¾æ¬¡åˆ°è¾¾è¿™é‡Œã€‚ç¬¬$i$ä¸ªåˆ°è¾¾çš„äººå°†é‡‡å–ä»¥ä¸‹è¡ŒåŠ¨ï¼š

- å¦‚æžœç«é¸¡$x_i$å’Œ$y_i$éƒ½è¿˜æ´»ç€ï¼šç­‰æ¦‚çŽ‡é€‰æ‹©å…¶ä¸­ä¸€åªï¼Œç„¶åŽåƒæŽ‰ã€‚
- å¦‚æžœç«é¸¡$x_i$æˆ–$y_i$ä¸­çš„ä¸€åªè¿˜æ´»ç€ï¼ˆä½†ä¸æ˜¯åŒæ—¶ï¼‰ï¼šåƒæŽ‰è¿˜æ´»ç€çš„é‚£åªã€‚
- å¦‚æžœç«é¸¡$x_i$å’Œ$y_i$éƒ½å·²ä¸å†æ´»ç€ï¼šä¸åšä»»ä½•äº‹æƒ…ã€‚

æ‰¾åˆ°æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„å¯¹$(i,\ j)$çš„æ•°é‡ï¼ˆ$1 â‰¤ i < j â‰¤ N$ï¼‰ï¼š

- åœ¨æ‰€æœ‰äººé‡‡å–è¡ŒåŠ¨åŽï¼Œç«é¸¡$i$å’Œ$j$éƒ½è¿˜æ´»ç€çš„æ¦‚çŽ‡å¤§äºŽ$0$ã€‚



-   $2 â‰¤ N â‰¤ 400$
-   $1 â‰¤ M â‰¤ 10^5$
-   $1 â‰¤ x_i \lt y_i â‰¤ N$

### æ€è€ƒ

å¦‚æžœæŠŠ $x_i$ å’Œ $y_i$ è¿žè¾¹ä¼šå‘ç”Ÿä»€ä¹ˆ 

å¯¹äºŽä¸€ä¸ª $i$ $j$ çš„è¯¢é—®ï¼Œç›¸å½“äºŽæˆ‘è¦ä¿æ´»ä»–ä»¬ã€‚å¯¹äºŽä¸Žä»–ä»¬ç›´æŽ¥ç›¸è¿žçš„è¾¹ï¼Œè¿™ä¸ªè¾¹çš„å¦ä¸€ç«¯çš„ç«é¸¡å¿…é¡»ç”±è¿™ä¸ªè¾¹æ€ï¼Œè¿™å¤šå‡ºæ¥äº†ä¸€äº›ç¡®å®šæ€§ã€‚

ç›¸å½“äºŽæŠŠè¾¹çš„å¦ä¸€ä¸ªç«¯ç‚¹å’Œè¿™ä¸ªè¾¹é…å¯¹äº†

é‚£ä¹ˆå¯¹äºŽå¦ä¸€ä¸ªç«¯ç‚¹å†è¿žå‡ºåŽ»çš„è¾¹ï¼Œå¿…é¡»å†å’Œå¦ä¸€ä¸ªç«¯ç‚¹é…å¯¹

å¦‚æžœä¸€ä¸ªç«¯ç‚¹ä¸å¾—ä¸å’Œä¸¤ä¸ªè¾¹é…å¯¹å°±çˆ†äº†ã€‚

å¦‚æžœä¸€ä¸ªè¾¹çš„ä¸¤ä¸ªç«¯ç‚¹éƒ½å’Œåˆ«äººé…å¯¹äº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

è¿™é‡Œä¼¼ä¹Žæœ‰ä¸€ä¸ªé™åˆ¶ï¼šè¿™ä¸ªè¾¹çš„æ“ä½œæ—¶é—´å¿…é¡»æ™šäºŽå®ƒä¸¤ä¸ªç«¯ç‚¹é…å¯¹è¾¹çš„æ“ä½œæ—¶é—´ï¼Œå¦åˆ™ä¹Ÿå¾—çˆ†äº†

è¿™ä¼¼ä¹Žå·²ç»æ˜¯ä¸€ä¸ªå……è¦æ¡ä»¶ï¼Œå¦‚æžœç¬¦åˆè¿™ä¸ªæƒ…å½¢ï¼Œä¸€å®šèƒ½æž„é€ æ–¹æ¡ˆï¼Œåä¹‹ï¼Œå¯¹äºŽæ‰€æœ‰çš„æ“ä½œåºåˆ—ï¼ŒæŸç§æ„ä¹‰ä¸Šå¿…ç„¶æ»¡è¶³è¿™ç§æƒ…å½¢

è¿™ä¼¼ä¹Žä¸æ˜¯ä¸€ä¸ªå›ºå®šçš„æ“ä½œ

å¯¹äºŽä¸Ž $ij$ ç›´æŽ¥ç›¸è¿žçš„è¾¹æ˜¯ç¡®å®šçš„ï¼Œå¿…é¡»æœå¤–ï¼Œå› ä¸ºéœ€è¦ä¿æ´»ç›®æ ‡ç«é¸¡ã€‚è¿™ä¸ªæ—¶å€™å°±åº”è¯¥æ‰§è¡Œä¸€äº›æ£€æŸ¥ï¼Œå¦‚æžœä¸€ä¸ªç«¯ç‚¹è¢«äºŒè€…åŒæ—¶éœ€è¦å°±çˆ†äº†ï¼Œå¦‚æžœä¸€ä¸ªè¾¹çš„ä¸¤ç«¯ç‚¹éƒ½å·²ç»è¢«é…å¯¹ï¼Œä¸”è¿™ä¸ªè¾¹çš„æ“ä½œæ—¶é—´ä¸æ˜¯æœ€æ™šçš„ä¹Ÿçˆ†äº†ã€‚

å‰©ä¸‹çš„è¾¹çš„åˆ†é…ä¼¼ä¹Žæ˜¯å¯å˜çš„ï¼Œæˆ‘éœ€è¦æƒ³åŠžæ³•åˆ†é…ï¼Œå°½å¯èƒ½ä½¿å…¶ä¸çˆ†ï¼Œçµæ´»çš„åˆ†é…ä¼šå½±å“æœ‰å“ªäº›è¾¹è¢«å¤¹åœ¨é…å¯¹ç‚¹ä¹‹é—´çš„checkã€‚

ä¸å¦¨ç§°ç¡®å®šæ€§çš„è¾¹ä¸º â€œå›ºå®šè¾¹â€ã€‚ä¸€å¼€å§‹çš„å›ºå®šè¾¹åªæœ‰ç›´æŽ¥å’Œ $ij$ ç›¸è¿žçš„è¾¹

å¦‚æžœä¸€ä¸ªéžå›ºå®šè¾¹ä¸Žå›ºå®šè¾¹ç›¸é‚»ï¼Œä¸”éžå›ºå®šè¾¹çš„æ“ä½œæ—¶é—´æ›´æ—©ï¼Œé‚£è¿™ä¸ªéžå›ºå®šè¾¹ä¸€å®šè¢«å›ºå®šäº†ã€‚å› ä¸ºè¿™ä¸ªéžå›ºå®šè¾¹çš„checkä¸€å®šä¼šçˆ†ï¼Œä¸ºäº†ä¸çˆ†è‚¯å®šä¼šæŠŠå®ƒå«è¿›æ¥ã€‚

ç›´æŽ¥è¿™æ ·æ‰©å±•åˆ°æžå¤§ä¹‹åŽï¼Œä¸æ‰©å±•è‚¯å®šæœ€ä¼˜äº†ï¼Œç›´æŽ¥checkå³å¯ã€‚

æœ´ç´ å®žçŽ°çš„å¤æ‚åº¦åº”è¯¥æ˜¯ $O(n^2(n+m))$ çš„ï¼Ÿ

ç²¾ç»†å®žçŽ°å¯èƒ½æ˜¯ $O(n^3)$ çš„ã€‚å…ˆä¸ç®¡

å¯¹äºŽæ¯ä¸ªç‚¹å…ˆè·‘ä¸€ä¸ªæœ€å°çš„å›ºå®šè¾¹è”é€šå—å‡ºæ¥ï¼Œå¦‚æžœç‚¹å¯¹ç‚¹é›†æœ‰äº¤å°±çˆ†ç‚¸äº†ã€‚è¿™ä¸ªæ˜¯å¯ä»¥ $O(\frac{n^3}{w})$ çš„ã€‚

è¾¹æ€Žä¹ˆåŠžï¼Ÿ

è¾¹çš„æ•°é‡æ˜¾ç„¶ä¹Ÿæ˜¯ $O(n)$ çš„ï¼æˆ‘ä»¬åªéœ€è¦è€ƒè™‘å’Œè”é€šå—ç›´æŽ¥ç›¸è¿žçš„è¾¹å°±è¡Œäº†ã€‚

å¤æ‚åº¦å¯ä»¥åšåˆ° $O(n^3+nm)$ï¼Œåº”è¯¥æ˜¯ T ä¸äº†çš„ã€‚

### Accept

è¿‡äº†ðŸ˜‹ï¸ðŸ˜‹ï¸ðŸ˜‹ï¸

é¢˜è§£åŸºæœ¬ä¹Ÿæ˜¯ $O(n^3+nm)$

```
int n,m;
vector<pair<int,int>> e[405];

void solve(bool SPE){ 
	n=RIN,m=RIN;
	foru(i,1,m){
		int u=RIN,v=RIN;
		e[u]+=mkp(v,i);
		e[v]+=mkp(u,i);
	}

	static bitset<405> in[405];
	static int opt[405][405];
	static bool fail[405];
	static vector<pair<int,int>> els[405];
	foru(i,1,n){
		in[i][i]=1;
		opt[i][i]=INT_MAX;
		auto dfs=[&i](auto dfs,int u,int T)->void {
			for(auto [v,t]:e[u]){
				if(in[i][v])	continue;
				if(t<T){
					in[i][v]=1;
					opt[i][v]=t;
					dfs(dfs,v,t);
				}
			}
		};
		for(auto [v,t]:e[i]){
			if(in[i][v]){
				fail[i]=1;
				goto fail;
			}
			in[i][v]=1;
			opt[i][v]=t;
		}
		for(auto [v,t]:e[i]){
			dfs(dfs,v,t);
		}
		foru(u,1,n){
			if(!in[i][u])	continue;
			for(auto [v,t]:e[u]){
				if(in[i][v]){
					if(t==opt[i][u] || t==opt[i][v])	continue;
					if(t<opt[i][u] || t<opt[i][v]){
						fail[i]=1;
						goto fail;
					}
				}else{
					if(t<opt[i][u]){
						fail[i]=1;
						goto fail;
					}
					els[i]+=mkp(v,t);
				}
			}
		}
		
		fail:;
	}

	int ans=0;
	foru(i,1,n){
		if(fail[i])	continue;
		foru(j,i+1,n){
			if(fail[j])	continue;
			if((in[i]&in[j]).count())	continue;
			
			for(auto [v,t]:els[i]){
				if(!in[j][v])	continue;
				if(t<opt[j][v])	goto chkfail;
			}
			for(auto [v,t]:els[j]){
				if(!in[i][v])	continue;
				if(t<opt[i][v])	goto chkfail;
			}
			ans++;
			chkfail:;
		}
	}
	cout<<ans;
	
	return ;
}
```



# P6631

Bob å–œæ¬¢åºåˆ—ã€‚

æœ‰ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„éžè´Ÿæ•´æ•°åºåˆ— $a_1, a_2,\cdots, a_n$ã€‚æ¯ä¸€æ­¥ä½ å¯ä»¥ä»Žä»¥ä¸‹ä¸‰ç§æ“ä½œä¸­é€‰æ‹©ä¸€ç§æ‰§è¡Œï¼š

- é€‰æ‹©ä¸€ä¸ªåŒºé—´ $[l, r]$ï¼Œå°†ä¸‹æ ‡åœ¨è¿™ä¸ªåŒºé—´é‡Œçš„æ‰€æœ‰æ•°éƒ½å‡ $1$ã€‚

- é€‰æ‹©ä¸€ä¸ªåŒºé—´ $[l, r]$ï¼Œå°†ä¸‹æ ‡åœ¨è¿™ä¸ªåŒºé—´é‡Œä¸”ä¸‹æ ‡ä¸ºå¥‡æ•°çš„æ‰€æœ‰æ•°éƒ½å‡ $1$ã€‚

- é€‰æ‹©ä¸€ä¸ªåŒºé—´ $[l, r]$ï¼Œå°†ä¸‹æ ‡åœ¨è¿™ä¸ªåŒºé—´é‡Œä¸”ä¸‹æ ‡ä¸ºå¶æ•°çš„æ‰€æœ‰æ•°éƒ½å‡ $1$ã€‚

æ±‚æœ€å°‘éœ€è¦å¤šå°‘æ­¥æ‰èƒ½å°†åºåˆ—ä¸­çš„æ‰€æœ‰æ•°éƒ½å˜æˆ $0$ã€‚

å¯¹äºŽ 100% çš„æ•°æ®ï¼Œ$1 \leq n \leq 100000, 0 \leq ai \leq 10^9, 1 \leq T \leq 10$ã€‚

### æ€è€ƒ

é¡ºç€ç›´æŽ¥DPä»€ä¹ˆçš„ä¼¼ä¹Žæœ‰ç‚¹å®Œè›‹ï¼Œä½†ä¹Ÿä¸å¥½è¯´

æœ‰ä»€ä¹ˆæ€§è´¨æˆ–è€…è½¬åŒ–ä¹ˆï¼Ÿ

æˆ‘ä»¬éœ€è¦ç¼©å°å†³ç­–èŒƒå›´

å¦‚æžœä¸€ä¸ªæ“ä½œä¸€ä¸¤ä¾§å„è‡ªç´§è·Ÿäº†æ“ä½œäºŒ / æ“ä½œä¸‰ï¼Œè‚¯å®šä¸ä¼˜ï¼Œå¯ä»¥æ›¿æ¢ä¸ºä¸€ä¸ªæ“ä½œäºŒå’Œä¸€ä¸ªæ“ä½œä¸‰æ‹¼èµ·æ¥ã€‚

å¦‚æžœåªæœ‰ä¸€è¾¹æœ‰ï¼Œæ›¿æ¢æŽ‰ä¹Ÿæ˜¯ä¸åŠ£çš„ã€‚

è¯´æ˜Žå¯¹äºŽä»»ä½•ä¸€ä¸ªæ“ä½œä¸€ $[l,r]$ ï¼Œä¸å­˜åœ¨ä»¥ $l-1$ ä¸ºå³ç«¯ç‚¹çš„ã€æˆ–ä»¥ $r+1$ ä¸ºå·¦ç«¯ç‚¹çš„ä»»ä½•æ“ä½œã€‚

æ“ä½œæ˜¯èƒ½äº¤æ¢çš„ï¼ŒæŠŠæ“ä½œä¸€æ”¾æœ€åŽï¼Ÿæ”¾æœ€å¼€å§‹ï¼Ÿéƒ½æœ‰ç‚¹æŠ½è±¡å•Š

### é¢˜è§£

æˆ‘è¶£ï¼Œçº¿æ€§è§„åˆ’å¯¹å¶ï¼



#### çº¿æ€§è§„åˆ’

å­¦åˆ°äº†ä¸€ç§[æ›´å¥½çš„æœºæ¢°å¼çº¿æ€§è§„åˆ’å¯¹å¶æµç¨‹](https://www.cnblogs.com/yyyyxh/p/17939643/LPdual)ï¼Œå¾ˆçµæ´»çš„ä¸€ç§æ–¹æ³•ã€‚



é¦–å…ˆæŠŠæ‰€æœ‰çš„ä¸ç­‰å¼é™åˆ¶éƒ½åŒ–ä½œ $\le 0$ çš„å½¢å¼ã€‚è¿™ä¸€æ­¥å¯ä»¥ç®€å•ç§»é¡¹å®Œæˆã€‚

ç„¶åŽä¸ºæ¯ä¸ªé™åˆ¶ï¼š

- å¼•å…¥ä¸€ä¸ªå› å­ $\lambda_i$
- å°†é™åˆ¶çš„å·¦ä¾§å¼å­æ•´ä½“ä¹˜ $\lambda _i$ ä¹‹åŽåŠ åˆ°æœ€ä¼˜åŒ–ç›®æ ‡å‡½æ•°ä¸Š

ä¹‹åŽè¿˜éœ€è¦ä¸ºæ¯ä¸ª $\lambda _i$ å¼•å…¥å®ƒçš„çº¦æŸã€‚å¯¹äºŽæ¯ä¸ª $\lambda _i$ï¼š

- å¦‚æžœå¯¹åº”çš„é™åˆ¶æ˜¯ç­‰å¼ï¼Œä¸ä¸º $\lambda _i$ æ·»åŠ çº¦æŸ
- å¦‚æžœå¯¹åº”çš„é™åˆ¶æ˜¯ä¸ç­‰å¼ï¼Œä¸”æœ€ä¼˜åŒ–ç›®æ ‡æ˜¯ $\min$ ï¼Œåˆ™æ·»åŠ  $\lambda _i\ge 0$ï¼Œå¦åˆ™æ·»åŠ  $\lambda _i \le 0$



çŽ°åœ¨æˆ‘ä»¬çš„æœ€ä¼˜åŒ–ç›®æ ‡å‡½æ•°å˜æˆäº†ä¸€ä¸ªå…³äºŽ $x$ å’Œ $\lambda$ çš„å¤šå…ƒå‡½æ•° $L(x,\lambda)$ã€‚

è€ƒè™‘ç”¨ä¸‹é¢è¿™ä¸ªå¼å­æ¥åœ¨æœ¬è´¨ä¸Šè¾…åŠ©æˆ‘ä»¬è¿›è¡Œä¸‹é¢çš„å·¥ä½œï¼šåœ¨æœ€ä¼˜åŒ–å‡½æ•°å‰é¢è¡¥å……**ä¸Žä½ çš„æœ€ä¼˜åŒ–æ–¹å‘ç›¸åçš„** $\min_{\lambda}$ / $\max_{\lambda}$

- è‹¥ä½ çš„æœ€ä¼˜åŒ–ç›®æ ‡ä¸º $\min_{x}L(x,\lambda)$ï¼Œæˆ‘ä»¬å¾—åˆ° $\max_{\lambda}\min_{x}L(x,\lambda)$
- è‹¥ä½ çš„æœ€ä¼˜åŒ–ç›®æ ‡ä¸º $\max_{x}L(x,\lambda)$ï¼Œæˆ‘ä»¬å¾—åˆ° $\min_{\lambda}\max_{x}L(x,\lambda)$



ä»¥ç¬¬ä¸€ä¸ªå¼å­ä¸ºä¾‹ï¼ŒåŽ»æŠŠè¿™ä¸ª $\max\min$ çš„è¿‡ç¨‹æƒ³è±¡ä¸ºä¸€ä¸ªäºŒäººæ¸¸æˆã€‚é‡Œé¢äººçš„ç›®æ ‡æ˜¯æœ€å°åŒ– $L(x,\lambda)$ï¼Œè€Œå¤–å±‚çš„äººçš„ç›®æ ‡æ˜¯æœ€å¤§åŒ–ã€‚å¤–å±‚çš„äººéœ€è¦é€šè¿‡ $\lambda$ çš„é€‰å–æ¥é™åˆ¶å†…å±‚äººçš„è¡ŒåŠ¨ã€‚

ä¸€ä¸ªç¡¬æ€§éœ€æ±‚æ˜¾ç„¶æ˜¯éœ€è¦é˜»æ­¢å†…å±‚çš„ $\min$ çŽ©å®¶æˆåŠŸåˆ°è¾¾ $-\infty$ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æŠŠ $L(x,\lambda)$ æ•´ç†ä¸º $x$ ä¸»å…ƒçš„å½¢å¼ï¼Œå¹¶æå–ç³»æ•°ã€‚

è€ƒè™‘ $L(x,\lambda)$ ä¸­ $x_i$ çš„ç³»æ•° $t_i$ï¼Œå…¶ä¸­ $t_i$ ç†åº”æ˜¯ä¸€ä¸ª $\lambda$ çš„çº¿æ€§ç»„åˆã€‚è‹¥ $x_i\ge0$ï¼Œåˆ™ $t_i$ æ˜¾ç„¶å¿…é¡»éžè´Ÿï¼Œå¦åˆ™å†…å±‚çŽ©å®¶å°±å¯ä»¥é å®ƒè¾¾åˆ° $-\infty$ã€‚ç±»ä¼¼åœ°ï¼Œå¯ä»¥æŽ¨å‡ºå½“ $x_i=0$ã€$x_i\le 0$ æ—¶ $t_i$ åº”è¯¥åˆ†åˆ«ä¸º $0$ã€éžæ­£ã€‚

åŒæ—¶ï¼Œ$L(x,\lambda)$ ä¸­æ˜¾ç„¶ä¼šå­˜åœ¨ä¸Ž $x$ æ— å…³çš„é¡¹ï¼ŒæŠŠä»–ä»¬ä»Žå†…å±‚çš„ $\min$ ä¸­æåˆ° $\max$ é‡Œæ¥ï¼Œå¹¶ç›´æŽ¥ä¸¢å¼ƒå†…å±‚çš„ $\min$ï¼Œå°±å¾—åˆ°äº†å¯¹å¶åŽçš„ç»“æžœï¼š

- å˜é‡æ˜¯ $\lambda$ï¼šå®ƒä»¬æ˜¯ç”±åŽŸé—®é¢˜çš„æ¯ä¸ªé™åˆ¶å¼•å…¥çš„ã€‚
- $\lambda$ çš„ç‰¹æ®Šé™åˆ¶ï¼ˆ$\ge 0$ ç­‰ï¼‰ï¼šå®ƒä»¬æ˜¯ç”±åŽŸé—®é¢˜æ¯ä¸ªé™åˆ¶çš„å½¢å¼å’Œæœ€ä¼˜åŒ–æ–¹å‘å†³å®šçš„
- $\lambda$ çš„çº¦æŸï¼šå®ƒä»¬æ˜¯ç”±åŽŸé—®é¢˜çš„é™åˆ¶ä¸ŽåŽŸæœ€ä¼˜åŒ–å‡½æ•°ç»„åˆå¾—åˆ°çš„
- æ–°çš„æœ€ä¼˜åŒ–ç›®æ ‡ï¼šå®ƒä»¬æ˜¯ç”±åŽŸé—®é¢˜çš„é™åˆ¶ç»„åˆå¾—åˆ°çš„

å®¹æ˜“å‘çŽ°è¿™æ ·ä¸ŽçŸ©é˜µè½¬ç½®çš„æœ¬è´¨ç›¸åŒï¼Œä½†é¿å…äº†å¾ˆå¤šç¹æ‚çš„æ“ä½œã€‚



ç”¨è¿™ä¸ªé—®é¢˜ç»ƒæ‰‹ï¼š
$$
\max\sum_{i=1}^mb_i\\
\text{s.t.}\quad a_i\le 1\\
b_i\le 1\\
b_i\le \sum_{j\in[l_i,r_i]}a_j\\
\sum_{i=1}^na_i\le k\\
a_i,b_i\ge 0
$$
é¦–å…ˆæ•´ç†æ‰€æœ‰é™åˆ¶
$$
\max\sum_{i=1}^mb_i\\
\text{s.t.}\quad a_i-1\le 0\\
b_i-1\le 0\\
b_i-\sum_{j\in[l_i,r_i]}a_j\le 0\\
\sum_{i=1}^na_i-k\le 0\\
a_i,b_i\ge 0
$$
å¼•å…¥ $\lambda=\{x,y,z,t\}$ å¹¶å¾—åˆ° $L(x,\lambda)$ å’Œ $\lambda$ çš„ç‰¹æ®Šé™åˆ¶
$$
L(x,\lambda)=\sum_{i=1}^mb_i+\sum_{i=1}^nx_i(a_i-1)+\sum_{i=1}^my_i(b_i-1)+\sum_{i=1}^mz_i(b_i-\sum_{j\in[l_i,r_i]}a_j)+t(\sum_{i=1}^na_i-k)\\
x_i,y_i,z_i,t\le 0
$$
æå– $a_i$ å’Œ $b_i$ çš„ç³»æ•°å¹¶å˜æ¢ä¸»å…ƒ
$$
L(x,\lambda)=\sum_{i=1}^na_i(x_i-\sum_{i\in[l_j,r_j]}z_j+t)+\sum_{i=1}^mb_i(y_i+z_i+1)-\sum_{i=1}^nx_i-\sum_{i=1}^ny_i-kt
$$
è€ƒè™‘ $\min_{\lambda}\max_x$ï¼Œç”±æ­¤å¾—åˆ° $\lambda$ çš„é™åˆ¶å’Œæ–°çš„æœ€ä¼˜åŒ–ç›®æ ‡ã€‚å¯¹å¶åŽçš„ç»“æžœå¦‚ä¸‹
$$
\min_{\lambda}-\sum_{i=1}^nx_i-\sum_{i=1}^ny_i-kt\\
\text{s.t.}\quad x_i-\sum_{i\in[l_j,r_j]}z_j+t\le 0\\
y_i+z_i+1\le 0\\
x_i,y_i,z_i,t\le 0
$$
éƒ½æ˜¯è´Ÿæ•°ï¼Œå…¨éƒ¨å–åä¸€ä¸‹å¯ä»¥å¾—åˆ°æ›´å¥½çœ‹çš„å½¢å¼
$$
\min_{\lambda}\sum_{i=1}^nx_i+\sum_{i=1}^ny_i+kt\\
\text{s.t.}\quad x_i+t\ge \sum_{i\in[l_j,r_j]}z_j\\
y_i+z_i\ge 1\\
x_i,y_i,z_i,t\ge 0
$$
è¿™æ ·å¯¹å¶ä¼šèˆ’æœå¾ˆå¤šã€‚

#### åŽŸé—®é¢˜

å›žåˆ°åŽŸé—®é¢˜ï¼Œç›¸å½“äºŽï¼Œæœ‰å¾ˆå¤šç§æ“ä½œï¼Œè¦ç»™æ¯ä¸ªæ“ä½œä¸€ä¸ªæƒå€¼ï¼ˆæ“ä½œæ¬¡æ•°ï¼‰ï¼Œæ»¡è¶³ä¸€äº›æ¡ä»¶çš„æƒ…å†µä¸‹æœ€å°åŒ–æƒå€¼å’Œã€‚

ä¸å¦¨è®¾æ‰€æœ‰æ“ä½œçš„é›†åˆï¼ˆä¿®æ”¹çš„åŒºé—´ä¸åŒä¹Ÿè§†ä½œæ“ä½œä¸åŒï¼‰ä¸º $S$ï¼Œè®¾ä¸€ä¸ªæ“ä½œ $i$ çš„æ“ä½œä¸‹æ ‡é›†åˆä¸º $O_i$
$$
\min_x\sum_{i\in S}x_i\\
\text{s.t.}\quad a_i=\sum_{j\in S,i\in O_j}x_j\\
x_i\ge 0
$$
ç›´æŽ¥å°†å…¶å¤§åŠ›å¯¹å¶ã€‚æ•´ç†å½¢å¼
$$
\min_x\sum_{i\in S}x_i\\
\text{s.t.}\quad \sum_{j\in S,i\in O_j}x_j-a_i=0\\
x_i\ge 0
$$
å¼•å…¥ $\lambda$ã€‚å› ä¸ºæ˜¯ç­‰å¼é™åˆ¶ï¼Œæ‰€ä»¥ $\lambda$ æ— ç‰¹æ®Šé™åˆ¶
$$
L(x,\lambda)=\sum_{i\in S}x_i+\sum_{i=1}^n\lambda_i(\sum_{j\in S,i\in O_j}x_j-a_i)\\
$$
å˜æ¢ä¸»å…ƒ
$$
L(x,\lambda)=\sum_{i\in S}x_i(\sum_{j\in O_i}\lambda _j+1)-\sum_{i=1}^n\lambda _ia_i
$$
è®¡ç®—å‡ºæ–°çš„çº¦æŸä¸Žæœ€ä¼˜åŒ–ç›®æ ‡ï¼Œå¾—åˆ°å¯¹å¶ç»“æžœ
$$
\max_{\lambda}-\sum_{i=1}^n\lambda _ia_i\\
\sum_{j\in O_i}\lambda _j+1\ge 0\\
$$
å…¨éƒ¨å–å
$$
\max_{\lambda}\sum_{i=1}^n\lambda _ia_i\\
\sum_{j\in O_i}\lambda _j\le 1\\
$$
è¿™å½¢å¼è¶…å¥½çœ‹ ðŸ˜°ï¸

é—®é¢˜å˜æˆï¼Œæˆ‘ä»¬è¦ç»™æ¯ä¸ªä½ç½®åˆ†é…ä¸€ä¸ªæƒå€¼ï¼Œæ»¡è¶³å¯¹äºŽæ‰€æœ‰å¯èƒ½çš„æ“ä½œï¼Œæ“ä½œä½ç½®çš„æƒå€¼å’Œä¸è¶…è¿‡ $1$ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæœ€å¤§åŒ–åºåˆ—çš„æƒå€¼ä¸Ž $a_i$ çš„ä¹˜ç§¯ã€‚

é¦–å…ˆå‡è£…æ‰€æœ‰ $\lambda$ éƒ½å–æ•´æ•°ã€‚

æ˜¾ç„¶å­˜åœ¨å•ç‚¹çš„æ“ä½œï¼Œå› æ­¤æˆ‘ä»¬æœ‰ $\lambda \le 1$

è¿›ä¸€æ­¥åœ°ï¼Œ$\lambda\le -2$ ä¹Ÿæ˜¯ä¸å¯èƒ½çš„ã€‚

è€ƒè™‘åè¯æ³•ï¼Œè‹¥ä¸€ä¸ª $\lambda_i$ åœ¨æœ€ä¼˜æƒ…å†µä¸‹å–äº† $\le-2$ï¼Œè¿™æ„å‘³ç€ä¸€å®šå­˜åœ¨ä¸€ä¸ªåŒ…å« $i$ çš„åŒºé—´ï¼Œæ»¡è¶³åŒºé—´å’Œæ­£å¥½ä¸º $1$ï¼Œå¦åˆ™ $\lambda$ å¯ä»¥å‘ä¸Šè°ƒæ•´ã€‚ä¸å¦¨å–ä¸€ä¸ªè¿™æ ·çš„åŒºé—´ä¸º $[L,R]$ã€‚

ç„¶è€Œæˆ‘ä»¬å‘çŽ°è¿™æ ·çš„ $[L,R]$ æ˜¯ä¸å¯èƒ½å­˜åœ¨çš„ï¼Œå› ä¸º $[L,i-1]$ çš„åŒºé—´å’Œ $\le 1$ï¼Œ$[i+1,R]$ çš„åŒºé—´ä¹Ÿå’Œ $\le 1$ï¼Œé‚£ä¹ˆ $[L,R]$ åŒºé—´å’Œçš„å–å€¼èŒƒå›´å°±ä¸º $\le 1+1-2=0$ï¼Œæ˜¯ä¸å¯èƒ½å–åˆ° $1$ çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬æŠŠ $\lambda$ çš„èŒƒå›´é™åˆ¶åœ¨äº† $\{-1,0,1\}$ é‡Œã€‚äºŽæ˜¯çŽ°åœ¨å°±å¯ä»¥è€ƒè™‘ DP äº†ã€‚

ä¸€ä¸ªå¾ˆæš´åŠ›çš„çŠ¶æ€è®¾è®¡æ˜¯ $f_{i,X,Y,Z}$ è¡¨ç¤ºè€ƒè™‘äº†å‰ $i$ ä¸ªä½ç½®ï¼Œæ¯ä¸ªåŽç¼€çš„åŽç¼€å’Œã€åŽç¼€å¥‡ä½ç½®å’Œã€åŽç¼€å¶ä½ç½®å’Œ**çš„é›†åˆ**åˆ†åˆ«ä¸º $X,Y,Z$ï¼Œè½¬ç§»å°±è€ƒè™‘ $\lambda _i+1$ çš„å–å€¼ï¼ŒæŠŠæ–°çš„å–å€¼åŠ å…¥ $XYZ$ åŽä¿è¯é›†åˆçš„æœ€å¤§å€¼æ—¶åˆ»ä¸è¶…è¿‡ $1$ å³å¯è½¬ç§»ã€‚è¿™ä¸ª DP çš„çŠ¶æ€æ•°æ˜¯éžå¸¸çˆ†ç‚¸çš„ $O(n^n)$

ç„¶åŽç«‹é©¬å‘çŽ°æˆ‘ä»¬åªé™åˆ¶é›†åˆæœ€å¤§å€¼ï¼Œä¸”æ¯æ¬¡æ“ä½œå½¢å¦‚ç»™é›†åˆåŠ å…¥ä¸€ä¸ªæ•°ï¼Œæˆ–ç»™æ•´ä¸ªé›†åˆåŠ ä¸Šä¸€ä¸ªå€¼ã€‚è¿™æ ·çš„æ“ä½œæ˜¯ä¸ä¼šå½±å“å…ƒç´ çš„ç›¸å¯¹é¡ºåºçš„ï¼ŒäºŽæ˜¯æˆ‘ä»¬å¯ä»¥åªè®°å½•é›†åˆæœ€å¤§å€¼ï¼Œè®¾ $f_{i,x,y,z}$ è¡¨ç¤ºè€ƒè™‘å‰ $i$ ä¸ªä½ç½®ï¼Œæœ€å¤§åŽç¼€å’Œã€æœ€å¤§åŽç¼€å¥‡ä½ç½®å’Œã€æœ€å¤§åŽç¼€å¶ä½ç½®å’Œåˆ†åˆ«æ˜¯ $x,y,z$ï¼Œèƒ½å¾—åˆ°æœ€å¤§çš„ $\sum_{j=1}^i\lambda _ja_j$ æ˜¯å¤šå°‘ã€‚ç›´æŽ¥è½¬ç§»å³å¯ï¼Œå¤æ‚åº¦ $O(n)$

