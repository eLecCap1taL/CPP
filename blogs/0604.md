# CF1566F

æ•°è½´ï¼Œ $ n $ ä¸ªç‚¹ï¼Œ $ m $ ä¸ªçº¿æ®µã€‚å¯èŠ±è´¹ 1 çš„ä»£ä»·æŒªåŠ¨ä¸€ä¸ªç‚¹ã€‚ä¸€ä¸ªçº¿æ®µè¢«æ ‡è®°ï¼Œå½“ä¸”ä»…å½“å­˜åœ¨ä¸€ä¸ªç‚¹ç»è¿‡äº†è¿™æ¡çº¿æ®µã€‚æ±‚æ ‡è®°æ‰€æœ‰çº¿æ®µçš„æœ€å°ä»£ä»·ã€‚

 $ n,m \leq 2\times 10^5 $ 

### æ€è€ƒ

åˆå§‹æƒ…å†µä¸‹å†…éƒ¨å«æœ‰ç‚¹çš„çº¿æ®µéƒ½æ²¡ç”¨äº†ï¼Œå› æ­¤æ‰€æœ‰çš„çº¿æ®µç°åœ¨ä¸åˆå§‹ç‚¹æ— äº¤ã€‚

å¦‚æœçº¿æ®µ A åŒ…å«çº¿æ®µ Bï¼Œé‚£ä¹ˆ A æ˜¯æ— ç”¨çš„ã€‚

å¦‚æœä¸¤ä¸ªç‚¹çš„è¡ŒåŠ¨è½¨è¿¹å‡ºç°äº†äº¤å‰é‚£ä¹ˆä¸€å®šä¸ä¼˜ã€‚å› æ­¤æ¯ä¸ªç‚¹çš„ç§»åŠ¨èŒƒå›´å°±æ˜¯åŒ…å«å®ƒåˆå§‹ä½ç½®çš„ä¸€å°æ®µåŒºé—´ã€‚

ä¸€ä¸ªç‚¹è¦ä¹ˆå‘å·¦æŒªåŠ¨è¦ä¹ˆå‘å³æŒªåŠ¨ã€‚å‡è®¾æœ€ç»ˆçš„ç§»åŠ¨èŒƒå›´åŒºé—´æ˜¯ $ [l,r] $ ï¼Œåˆå§‹ä½ç½®ä¸º $ i $ ï¼Œé‚£ä¹ˆä»£ä»·ä¸€å®šä¸º $ r-l+\min(i-l,r-i) $ ã€‚ç°åœ¨è¦å†³å®šçš„é—®é¢˜å°±æ˜¯æ¯ä¸ªç‚¹çš„è¿™ä¸ªåŒºé—´æ˜¯ä»€ä¹ˆã€‚

å°è¯•ä¾æ¬¡æšä¸¾æ¯ä¸ªç‚¹å…ˆå‘å·¦è¿˜æ˜¯å…ˆå‘å³ã€‚å¤±è´¥

è€ƒè™‘åˆ°ä¸¤ä¸ªç‚¹åŒºé—´ä¹‹é—´çš„ç©ºéš™ä¸ä¼šäº§ç”Ÿè´¡çŒ®ï¼Œç›¸å½“äºè¢« "èŠ‚çœ" äº†ã€‚çŒœæµ‹å¯ä»¥å…ˆè´ªå¿ƒé€‰æ‹©ç©ºéš™æœ€å¤§çš„éƒ¨åˆ†ã€‚å‘ç°å¯ä»¥è¿›ä¸€æ­¥è°ƒæ•´ï¼Œå¤±è´¥ã€‚

### é¢˜è§£

å°è¯•æšä¸¾æ¯ä¸ªç‚¹çš„æ–¹å‘è¿›è¡Œ DP å®åˆ™æ˜¯å¯è¡Œçš„ã€‚

ä¼šè§‰å¾— $ f_{i,0/1} $ æ— æ³•è½¬ç§»çš„åŸå› æ˜¯ï¼Œè½¬ç§»æ—¶å¯ä»¥å‘å·¦ä¾§æšä¸¾çº¿æ®µï¼Œä½†è¿™ä¸ªçŠ¶æ€æ²¡è®°å½•å‘å³èµ°åˆ°å“ªï¼Œæ²¡æ³•ç®—ç­”æ¡ˆã€‚ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯æŠŠå‘å³çš„ä½ç½®å¼€è¿›çŠ¶æ€é‡Œï¼Œå³ $ f_{i,0/1,j} $ è¡¨ç¤ºäº† $ i $ æœ€å³æŠµè¾¾ $ j $ è¿™ä¸ªçº¿æ®µå·¦ä¾§ï¼Œå³å¯è½¬ç§»ã€‚çŠ¶æ€æ•°å‡æ‘Šä¸‹æ¥æ˜¯çº¿æ€§çš„ï¼Œä½†è½¬ç§»å¤æ‚åº¦æ˜¯å¹³æ–¹çš„ï¼Œåº”è¯¥å¯ä»¥ä½¿ç”¨æ•°æ®ç»“æ„ä¼˜åŒ–ã€‚

æ›´å¥½çš„åŠæ³•æ˜¯æ‹†å¼€è®¡ç®—ã€‚

è½¬ç§»æ—¶æˆ‘ä»¬æšä¸¾ä¸€ä¸ª $ i-1 $ å’Œ $ i $ ä¹‹é—´çš„çº¿æ®µï¼Œå¹¶æšä¸¾ $ i-1 $ æ˜¯å‘å·¦è¿˜æ˜¯å‘å³ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠ $ i-1 $ å³ä¾§çš„éƒ¨åˆ†äº¤ç”± $ f_i $ è®¡ç®—ã€‚æœ¬è´¨ä¸Šæ¥è¯´ï¼ŒçŠ¶æ€çš„å®šä¹‰æ”¹å˜äº†ï¼Œå˜ä¸º $ f_{i,0/1} $ è¡¨ç¤ºè€ƒè™‘äº†å‰ $ i $ ä¸ªç‚¹ï¼Œç¬¬ $ i $ ä¸ªç‚¹å…ˆå‘å·¦ / å³ï¼Œä¸”ä¸è€ƒè™‘ $ i $ å³ä¾§ç§»åŠ¨ä»£ä»·çš„æœ€å°ä»£ä»·ã€‚

èƒ½è¿™æ ·åšæ˜¯å› ä¸ºï¼Œ $ j $ çš„ç»´åº¦å¯¹äºè½¬ç§»æ—¶ï¼Œè´¡çŒ®äº†ä¸€ä¸ªä¸ $ f_i $ æ— å…³çš„é‡ã€‚æ—¢ç„¶å®ƒåªä¸ $ i,j $ ä¸‹æ ‡æœ‰å…³ï¼Œè€Œ**ä¸ $ i $ çš„å†³ç­–æ— å…³**ï¼ŒæŠŠå®ƒå¼€æˆç»´åº¦å°±æ˜¯æ²¡æœ‰æ„ä¹‰ä¸”æµªè´¹çš„ã€‚

> åˆ«æ€¥ç€ä¸¢æ‰ä¸€ä¸ª DP

```
int n,m;
LL a[MAXN];
class Range{
public:
	LL l,r;

	bool operator < (const Range& x)const{
		if(r==x.r)	return l>x.l;
		return r>x.r;
	}
};
vector<Range> ls[MAXN];
void solve(bool SPE){ 
	n=RIN,m=RIN;
	foru(i,1,n){
		a[i]=RIN;
	}
	sort(a+1,a+1+n);
	
	foru(i,0,n){
		ls[i].clear();
	}

	static set<pair<LL,int>> st;
	st.clear();
	st+=mkp(LLONG_MIN,0);
	st+=mkp(LLONG_MAX,n+1);
	foru(i,1,n){
		st+=mkp(a[i],i);
	}
	foru(i,1,m){
		int l=RIN,r=RIN;
		auto it=st.lower_bound(mkp(l,0));
		if(it->fi<=r){
			//useless segment
			continue;
		}
		ls[prev(it)->se]+=Range{l,r};
	}

	static LL f[MAXN][2];
	foru(i,0,n+1){
		f[i][0]=f[i][1]=0;
	}

	// init f[1];
	{
		int L=a[1];
		for(auto [l,r]:ls[0]){
			chkmin(L,r);
		}
		f[1][0]=2*(a[1]-L);
		f[1][1]=(a[1]-L);
	}

	foru(i,2,n){
		//enum segments between i-1 and i
		sort(All(ls[i-1]));

		f[i][0]=f[i][1]=LLONG_MAX;

		static vector<LL> pre;
		pre.clear();
		pre.resize(ls[i-1].size()+1,a[i-1]);
		for(int j=ls[i-1].size()-1;j>=0;j--){
			pre[j]=max(pre[j+1],(LL)ls[i-1][j].l);
		}

		size_t ptr=0;
		for(size_t j=0;j<ls[i-1].size();j++){
			LL L=ls[i-1][j].r;
			LL R=a[i-1];
			while(ptr<ls[i-1].size() && ls[i-1][ptr].r==L)	ptr++;
			// for(size_t k=j+1;k<ls[i-1].size();k++){
			// 	if(ls[i-1][k].r!=L){
			// 		chkmax(R,ls[i-1][k].l);
			// 		// chkmax(R,pre[k]);
			// 		// break;
			// 	}
			// }
			chkmax(R,pre[ptr]);
			LL v0=f[i-1][0]+(R-a[i-1]);
			LL v1=f[i-1][1]+(R-a[i-1])*2;
			chkmin(f[i][0],min(v0,v1)+(a[i]-L)*2);
			chkmin(f[i][1],min(v0,v1)+(a[i]-L));
		}

		LL v0=f[i-1][0]+(pre[0]-a[i-1]);
		LL v1=f[i-1][1]+(pre[0]-a[i-1])*2;
		chkmin(f[i][0],min(v0,v1));
		chkmin(f[i][1],min(v0,v1));
	}

	LL ans=LLONG_MAX;
	
	LL R=a[n];
	for(auto [l,r]:ls[n]){
		chkmax(R,l);
	}

	ans=min(f[n][0]+(R-a[n]),f[n][1]+(R-a[n])*2);

	cout<<ans<<'\n';

	// exit(0);
	return ;
}
```

# P8179

æœ‰ $ n $ å¥—è½®èƒï¼Œæ»´å‰éœ€è¦ç”¨è¿™äº›è½®èƒè·‘ $ m $ åœˆã€‚

ä½¿ç”¨ç¬¬ $ i $ å¥—è½®èƒè·‘çš„ç¬¬ $ j $ åœˆï¼ˆå¯¹æ¯å¥—è½®èƒå•ç‹¬è®¡æ•°ï¼‰éœ€è¦ $ a_i+b_i(j-1)^2 $ ç§’ã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œä½ ä¸éœ€è¦æ‹…å¿ƒçˆ†èƒï¼Œå®‰å…¨è½¦ï¼Œçº¢æ——æˆ–è€…ä¸åŒçš„æ¯”èµ›ç­–ç•¥ã€‚

æ»´å‰éœ€è¦è¿›å…¥ç»´ä¿®ç«™æ¥æ›´æ¢è½®èƒï¼Œæ‰€æ¶ˆè€—çš„æ—¶é—´ä¸º $ t $ ç§’ã€‚ç‰¹åˆ«åœ°ï¼Œæ»´å‰ä½¿ç”¨çš„**ç¬¬ä¸€å¥—**è½®èƒä¸éœ€è¦è¿›ç«™æ›´æ¢ã€‚

ä¸ºäº†å¸®åŠ©æ»´å‰æ‹¿ä¸‹ WDCï¼Œä½ éœ€è¦æœ€å°åŒ–æ€»æ—¶é—´ï¼Œæ€»æ—¶é—´ç­‰äºæ¯åœˆçš„æ—¶é—´ä¹‹å’ŒåŠ ä¸Šè¿›ç«™æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚

 $ 1\leq n,b_i\leq 500 $ ï¼Œ $ 0\leq t\leq 500 $ ï¼Œ $ 1\leq m\leq 2 \times 10^5 $ ï¼Œ $ 1\leq a_i\leq 10^9 $ ã€‚

### æ€è€ƒ

DPï¼Œå†³ç­–å•è°ƒæ€§å¯ä»¥åšåˆ° $ O(nm\log m) $ 

è½¬ç§»é‡Œçš„å¹³æ–¹å’Œå…¬å¼å¾ˆçƒ¦
$$
(j-k-1)(j-k)(2j-2k-1)\\
$$
æ‹†å¼€è‚¯å®šä¼šæœ‰ $ jk $ çš„é¡¹ã€‚å¾—åœ¨çº¿æ€§æ—¶é—´ç»´æŠ¤

ç»§ç»­æ‰¾æ€§è´¨ï¼Ÿ

### é¢˜è§£

åº”è¯¥ä» $ t=0 $ çš„åœ°æ–¹å…¥æ‰‹ã€‚

 $ t=0 $ æ„å‘³ç€æ¢è½®èƒæ— æ¶ˆè€—ã€‚åˆå› ä¸ºè½®èƒéšä½¿ç”¨çš„æ¯åœˆå¼€é”€æ˜¯å•è°ƒé€’å¢çš„ï¼Œå¯ä»¥ç›´æ¥ç”¨ä¸€ä¸ªå †è´ªå¿ƒã€‚ $ O(m\log m) $ 

è€ƒè™‘ $ t\neq 0 $ çš„æƒ…å†µã€‚é¦–å…ˆå®¹æ˜“å‘ç°ä¸€æ—¦ç”¨ä¸€ä¸ªè½®èƒå°±ä¸€å®šè¿ç»­åŒºé—´ä½¿ç”¨ã€‚åˆ‡æ¢åˆ°åˆ«çš„è½®èƒå†åˆ‡æ¢å›æ¥å®Œå…¨ä¸ä¼˜ã€‚

å› æ­¤å¯ä»¥ç›´æ¥æŠŠ $ t $ "åŠ ç»™" æ¯ä¸ªè½®èƒçš„ç¬¬ä¸€åœˆå¼€é”€ã€‚ç°åœ¨ä¸å­˜åœ¨ $ t $ äº†ã€‚

ä½†æ­¤æ—¶å‘ç°æ— æ³•è´ªå¿ƒï¼Œå› ä¸ºè½®èƒçš„å¼€é”€ä¸æ˜¯å•è°ƒé€’å¢çš„äº†ã€‚

**ä½†æ¯ä¸ªè½®èƒé™¤ç¬¬ä¸€åœˆä»¥å¤–çš„éƒ¨åˆ†ä¾ç„¶æ˜¯å•è°ƒé€’å¢çš„ï¼Œä¸”æ³¨æ„åˆ° $ t $ å¾ˆå°ï¼Œè¿™å¾ˆå¥‡æ€ªï¼ŒæŒ‰ç†è¯´ $ t $ å¦‚æœä¸ç”¨è¢«ç®—è¿›å¤æ‚åº¦é‡Œï¼Œæ˜¯æ²¡é“ç†è¿™ä¹ˆå°çš„ï¼Œæ­£å¦‚ $ a_i,b_i\le 10^9 $ ã€‚**

åœ¨éå•è°ƒæ—¶ï¼Œæˆ‘ä»¬æœ‰ DP åšæ³•ï¼Œå¤æ‚åº¦è¾ƒé«˜ã€‚åœ¨å•è°ƒæ—¶ï¼Œæˆ‘ä»¬æœ‰è´ªå¿ƒåšæ³•ï¼Œå¤æ‚åº¦è¾ƒä½ã€‚

å°è¯•æŠŠäºŒè€…æ‹¼èµ·æ¥ã€‚æˆ‘ä»¬éœ€è¦ç»™è½®èƒåˆ’çš„ä½¿ç”¨åˆ†æˆä¸¤ä¸ªé˜¶æ®µã€‚ç¬¬ä¸€é˜¶æ®µä¸å•è°ƒï¼Œç¬¬äºŒé˜¶æ®µå•è°ƒã€‚æˆ‘ä»¬å°†åœ¨ç¬¬ä¸€é˜¶æ®µä½¿ç”¨ DP å†³ç­–ï¼Œç¬¬äºŒé˜¶æ®µä½¿ç”¨è´ªå¿ƒå†³ç­–ï¼Œæœ€åæšä¸¾ç¬¬ä¸€é˜¶æ®µä½¿ç”¨çš„è½®èƒæ€»æ•°ï¼ŒæŠŠäºŒè€…æ‹¼èµ·æ¥ã€‚

å¦‚æœåªå…³æ³¨å•è°ƒæ€§ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥åªæŠŠç¬¬ä¸€ä¸ªè½®èƒåˆ†ä¸ºç¬¬ä¸€é˜¶æ®µã€‚

ä½†åˆ†é˜¶æ®µä¼šå¸¦æ¥é—®é¢˜ã€‚

å‡è®¾å¯¹äºæŸä¸ªè½®èƒï¼Œæˆ‘ä»¬æŠŠå®ƒçš„å‰ $ x $ åœˆåˆ’åˆ†ä¸ºç¬¬ä¸€é˜¶æ®µï¼Œé‚£ä¹ˆåœ¨æ‹¼ç­”æ¡ˆçš„æ—¶å€™ï¼Œå°±ä¸å¯é¿å…çš„å¯èƒ½ä¼šå­˜åœ¨è¿™ç§æƒ…å†µï¼šç¬¬ä¸€é˜¶æ®µå¹¶æ²¡æœ‰å–æ»¡ $ [1,x] $ çš„æ‰€æœ‰åœˆã€‚

è¿™ç§æƒ…å†µæ˜¾ç„¶æ˜¯éæ³•çš„ã€‚æˆ‘ä»¬å¸Œæœ›è¿™ç§æƒ…å†µèƒ½è¢«è‡ªåŠ¨åœ°æ’é™¤æ‰ï¼Œ**å¸Œæœ›å¯¹äºæ¯ä¸ªéæ³•æƒ…å†µï¼Œä¸€å®šå­˜åœ¨ä¸€ä¸ªåˆæ³•æƒ…å†µæ¯”è¿™ä¸ªéæ³•æƒ…å†µæ›´ä¼˜**ã€‚

æˆ‘ä»¬å°è¯•å¯¹äºæ¯ä¸ªéæ³•æƒ…å†µæ„é€ å¯¹åº”çš„æ›´ä¼˜åˆæ³•æƒ…å†µã€‚ä¸€ä¸ªå¾ˆæ— è„‘çš„åšæ³•æ˜¯ï¼ŒæŠŠè´ªå¿ƒéƒ¨åˆ†é€‰çš„è½®èƒå¾€å‰æ¨ï¼Œè¡¥å……åˆ° $ [1,x] $ ä¸­ã€‚

å¦‚æœæˆ‘ä»¬çš„ç¡®åœ¨ç¬¬ä¸€é˜¶æ®µé€‰äº†ç¬¬ $ 1 $ åœˆï¼Œé‚£ä¹ˆè¿™ä¸ªæ“ä½œæ˜¯æ²¡é—®é¢˜çš„ï¼Œä¸€å®šä¼šå¾—åˆ°æ›´ä¼˜çš„åˆæ³•è§£ã€‚ä½†å¦‚æœç¬¬ä¸€åœˆæ²¡æœ‰è¢«é€‰æ‹©ï¼Œé‚£æˆ‘ä»¬å°±æ— æ³•åˆ†æäºŒè€…çš„ä¼˜åŠ£ã€‚æ‹¼ç­”æ¡ˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ— æ³•é’¦å®šæ˜¯å¦é€‰ç¬¬ä¸€åœˆï¼Œæ²¡æ³•åšã€‚

è€ƒè™‘ä¸ºä»€ä¹ˆæ— æ³•åˆ†æäºŒè€…ä¼˜åŠ£ã€‚æœ¬è´¨ä¸Šæ˜¯å› ä¸º $ a_i+t $ **æœ‰å¯èƒ½æ¯”è´ªå¿ƒéƒ¨åˆ†çš„å¼€é”€å¤§**ï¼Œå¯¼è‡´æ¨è¿‡å»åè€Œæ›´åŠ£ã€‚

é‚£ä¹ˆç­”æ¡ˆå‘¼ä¹‹æ¬²å‡ºäº†ï¼Œæˆ‘ä»¬åªéœ€è¦æ’é™¤æ‰è¿™ç§æƒ…å†µå³å¯ã€‚

å³ï¼Œæˆ‘ä»¬å¸Œæœ›è´ªå¿ƒéƒ¨åˆ†çš„å¼€é”€å…¨éƒ¨æ¯” $ a_i+t $ æ›´å¤§ã€‚
$$
a_i+t\le a_i+b_i(x-1)^2
$$
å‘ç°è¿™ä¸ªé¢˜éå¸¸å‰å®³åœ°ä¿è¯äº† ** $ b_i>0 $ ** ã€‚å› æ­¤å¯ä»¥å¾—åˆ° $ x\ge \sqrt{t}+1 $ ã€‚äºæ˜¯æˆ‘ä»¬åªéœ€è¦æŠŠå‰ $ \sqrt{t}+1 $ åœˆåˆ†ä¸ºç¬¬ä¸€é˜¶æ®µåš DP å³å¯ã€‚åˆ†æä¸€ä¸‹å¤æ‚åº¦ä¸º $ O(n^2t+m\log m) $ ã€‚ä½¿ç”¨å†³ç­–å•è°ƒæ€§ä¼˜åŒ–å¯ä»¥åšåˆ° $ O(n^2\sqrt{t}\log{\sqrt{t}}+m\log m) $ ã€‚å‰è€…å³å¯è½»æ¾é€šè¿‡ã€‚

> è§‚å¯Ÿè¯¡å¼‚çš„æ•°æ®èŒƒå›´

```
int n,m,t;
class Item{
public:
	LL a,b;
}a[505];

LL f[505][505*30];

LL calc(LL n){
	return n*(n+1)*(2*n+1)/6ll;
}

void solve(bool SPE){ 
	n=RIN,m=RIN,t=RIN;

	foru(i,1,n){
		a[i]={RIN,RIN};
	}
	
	int P=ceil(sqrt(t))+5;

	f[0][0]=0;
	foru(i,1,n*P){
		f[0][i]=1e18;
	}

	// cerr<<a[2].a<<endl;
	foru(i,1,n){
		foru(j,1,n*P){
			f[i][j]=f[i-1][j];
			foru(k,1,min(j,P)){
				if(f[i-1][j-k]==1e18)	continue;
				// cerr<<i<<' '<<j<<' '<<k<<endl;
				// if(i==2 && j==4 && k==3){
				// 	cerr<<' '<<a[2].a<<endl;
				// }
				chkmin(f[i][j],f[i-1][j-k]+t+a[i].a*k+a[i].b*calc(k-1));
			}
		}
	}
	// exit(0);
	// cout<<f[2][4]-t<<endl;
	// exit(0);
	static priority_queue<pair<i128,int>,vector<pair<i128,int>>,greater<pair<i128,int>>> q;
	static int cur[505];
	foru(i,1,n){
		cur[i]=P+1;
		q.push(mkp(a[i].a+a[i].b*P*P,i));
	}
	static i128 g[MAXN];
	g[0]=0;
	foru(i,1,m){
		g[i]=g[i-1];
		auto [v,id]=q.top();
		q.pop();
		g[i]+=v;
		cur[id]++;
		q.push(mkp(a[id].a+(i128)a[id].b*(cur[id]-1)*(cur[id]-1),id));
	}

	// cout<<P<<endl;

	i128 ans=i128(1e15)*i128(1e15);
	foru(i,0,min(n*P,m)){
		chkmin(ans,f[n][i]-t+g[m-i]);
	}
	cout<<ans;

	return ;
}
```



# CF1592F1

ç»™å®šä¸€ä¸ª $ n $ è¡Œ $ m $ åˆ—çš„ç›®æ ‡çŸ©é˜µï¼ŒçŸ©é˜µå…ƒç´ åªæœ‰ W æˆ– B ï¼Œå¹¶ä¸”ä½ æœ‰ä¸€ä¸ªåˆå§‹çŸ©é˜µï¼Œå…ƒç´ å…¨ä¸º W ã€‚

ç°åœ¨ä½ å¯ä»¥çŸ©é˜µå®æ–½ä»¥ä¸‹æ“ä½œï¼š

1. ä½¿ç”¨ä¸€å—é’±ï¼Œé€‰å®šä¸€ä¸ªåŒ…å« $ (1,1) $ çš„å­çŸ©é˜µï¼ŒæŠŠçŸ©é˜µä¸­çš„å…ƒç´ å…¨éƒ¨åè½¬ï¼ˆ W å˜ B ï¼Œ B å˜ W ï¼‰ã€‚
2. ä½¿ç”¨ä¸¤å—é’±ï¼Œé€‰å®šä¸€ä¸ªåŒ…å« $ (n,1) $ çš„å­çŸ©é˜µï¼ŒæŠŠçŸ©é˜µä¸­çš„å…ƒç´ å…¨éƒ¨åè½¬ã€‚
3. ä½¿ç”¨å››å—é’±ï¼Œé€‰å®šä¸€ä¸ªåŒ…å« $ (1,m) $ çš„å­çŸ©é˜µï¼ŒæŠŠçŸ©é˜µä¸­çš„å…ƒç´ å…¨éƒ¨åè½¬ã€‚
4. ä½¿ç”¨ä¸‰å—é’±ï¼Œé€‰å®šä¸€ä¸ªåŒ…å« $ (n,m) $ çš„å­çŸ©é˜µï¼ŒæŠŠçŸ©é˜µä¸­çš„å…ƒç´ å…¨éƒ¨åè½¬ã€‚

ç°åœ¨éœ€è¦ä½ æ±‚å‡ºæŠŠåˆå§‹çŸ©é˜µå˜ä¸ºç›®æ ‡çŸ©é˜µæœ€å°‘éœ€è¦å‡ å—é’±ã€‚

### æ€è€ƒ

23æ“ä½œéƒ½æ˜¯æ— ç”¨çš„ï¼Œå¯ä»¥ç”¨1æ“ä½œä»£æ›¿ä¸åŠ£

å¦‚æœåªæœ‰ 1 æ“ä½œï¼Œä»£ä»·æ˜¯ç¡®å®šæ€§çš„ï¼Œä»å³ä¸‹è§’å¼€å§‹è®¡ç®—å³å¯

è€ƒè™‘ç”¨ 4 æ“ä½œå»æ›¿æ¢ 1 æ“ä½œ

åªæœ‰ä¸€ç§æƒ…å†µå¯èƒ½è¢«æ›¿æ¢ï¼Ÿ

ç”¨ä¸€æ¬¡ 4ï¼Ÿ

å¹¶éï¼Œä½†ç­”æ¡ˆå·®å¾—å¹¶ä¸å¤š

å¯ä»¥ç”¨1ä¸ª4æ›¿æ¢4ä¸ª1

å¯ä»¥ç”¨2ä¸ª4æ›¿æ¢7ä¸ª1

ä¸å¥½æ“ä½œ

### é¢˜è§£

åˆšæ‰åˆ†æçš„ 2ä¸ª4 æ›¿æ¢ 7ä¸ª1 å®åˆ™åˆ†ææœ‰è¯¯ã€‚å¹¶ä¸”æš´åŠ›ä»£ç å†™é”™äº†ï¼Œå¦‚æœå†™å¯¹çš„è¯åº”è¯¥å¯ä»¥æ³¨æ„åˆ°åªä¼šç”¨ä¸€æ¬¡ 4ã€‚

å¯¹çŸ©é˜µåšä¸€æ­¥ç¥ç§˜è½¬åŒ–

 $ s_{i,j}=a_{i,j}\oplus a_{i+1,j} \oplus a_{i,j+1} \oplus a_{i+1,j+1} $ 

é¦–å…ˆï¼ŒåŸçŸ©é˜µå˜ä¸ºå…¨ 0 ç­‰ä»·äºè¿™ä¸ªçŸ©é˜µå˜ä¸ºå…¨ 0ã€‚å¹¶ä¸”æ³¨æ„åˆ°è¿™æ ·å˜å½¢ä¹‹åï¼Œæ“ä½œä¸€å˜æˆäº†åªåè½¬ $ s_{i,j} $ ï¼Œæ“ä½œå››å˜æˆäº†åè½¬ $ s_{i-1,j-1},s_{i-1,m},s_{n,j-1},s_{n,m} $ å››ä¸ªæ ¼å­ã€‚

è¿™æ ·ä¸€æ¥å°±å˜å¾—éå¸¸ç®€å•äº†ã€‚æ³¨æ„åˆ°ä½œä¸¤æ¬¡æ“ä½œå››æ˜¯ä¸ä¼˜çš„ï¼Œå› ä¸º $ s_{n,m} $ è¢«åè½¬ä¸¤æ¬¡ï¼Œä¸€å…±åªæ“ä½œäº† $ 6 $ ä¸ªæ ¼å­ï¼Œä¸ä¼˜äºæ“ä½œä¸€ã€‚å› æ­¤æˆ‘ä»¬åªä¼šä½¿ç”¨ä¸€æ¬¡æ“ä½œå››ã€‚

æ­£å¸¸åè½¬ä¹‹åå¤„ç†æ“ä½œå››å³å¯ã€‚

> å¦‚æœä¸€ä¸ªè¿‡ç¨‹éš¾ä»¥åˆ»ç”»ï¼Œå°è¯•æŠŠä»–è½¬åŒ–æˆæ›´ç®€å•çš„è¿‡ç¨‹ï¼ŒåŒæ—¶ä¸åŸå…ˆç­‰ä»·

```
int n,m;
int a[505][505];
bitset<505> b[505];
void solve(bool SPE){ 
	n=RIN,m=RIN;
	foru(i,1,n){
		foru(j,1,m){
			a[i][j]=RCIN=='B';
		}
	}
	
	foru(i,1,n){
		foru(j,1,m){
			a[i][j]^=a[i+1][j]^a[i][j+1]^a[i+1][j+1];
		}
	}

	int ans=0;

	foru(i,1,n){
		foru(j,1,m){
			ans+=a[i][j];
		}
	}

	foru(i,1,n-1){
		foru(j,1,m-1){
			if(a[i][j] && a[n][j] && a[i][m] && a[n][m]){
				ans--;
				goto fd;
			}
		}
	}

	fd:

	cout<<ans;
	return ;
}
```



# CF1592F2

ç»™å®šä¸€ä¸ª $ n $ è¡Œ $ m $ åˆ—çš„ç›®æ ‡çŸ©é˜µï¼ŒçŸ©é˜µå…ƒç´ åªæœ‰ W æˆ– B ï¼Œå¹¶ä¸”ä½ æœ‰ä¸€ä¸ªåˆå§‹çŸ©é˜µï¼Œå…ƒç´ å…¨ä¸º W ã€‚

ç°åœ¨ä½ å¯ä»¥çŸ©é˜µå®æ–½ä»¥ä¸‹æ“ä½œï¼š

ä½¿ç”¨ä¸€å—é’±ï¼Œé€‰å®šä¸€ä¸ªåŒ…å« $ (1,1) $ çš„å­çŸ©é˜µï¼ŒæŠŠçŸ©é˜µä¸­çš„å…ƒç´ å…¨éƒ¨åè½¬ï¼ˆ W å˜ B ï¼Œ B å˜ W ï¼‰ã€‚

ä½¿ç”¨ä¸‰å—é’±ï¼Œé€‰å®šä¸€ä¸ªåŒ…å« $ (n,1) $ çš„å­çŸ©é˜µï¼ŒæŠŠçŸ©é˜µä¸­çš„å…ƒç´ å…¨éƒ¨åè½¬ã€‚

ä½¿ç”¨å››å—é’±ï¼Œé€‰å®šä¸€ä¸ªåŒ…å« $ (1,m) $ çš„å­çŸ©é˜µï¼ŒæŠŠçŸ©é˜µä¸­çš„å…ƒç´ å…¨éƒ¨åè½¬ã€‚

ä½¿ç”¨ä¸¤å—é’±ï¼Œé€‰å®šä¸€ä¸ªåŒ…å« $ (n,m) $ çš„å­çŸ©é˜µï¼ŒæŠŠçŸ©é˜µä¸­çš„å…ƒç´ å…¨éƒ¨åè½¬ã€‚

ç°åœ¨éœ€è¦ä½ æ±‚å‡ºæŠŠåˆå§‹çŸ©é˜µå˜ä¸ºç›®æ ‡çŸ©é˜µæœ€å°‘éœ€è¦å‡ å—é’±ã€‚

### æ€è€ƒ

è¿™æ¬¡ 2 3 æ“ä½œä¼¼ä¹è¿˜æ˜¯æ¥æç¬‘çš„ï¼Œå¿½ç•¥ä»–

æœ‰äº†åˆšæ‰çš„æ„é€ ï¼Œç°åœ¨å˜æˆä¸€å—é’±åè½¬æŸä¸ªï¼Œæˆ–ä¸¤å—é’±åè½¬ä¸€ä¸ªçŸ©å½¢çš„å››è§’

è¿™æ¬¡ä¸æ˜¯åªç”¨ä¸€ä¸ªå››äº†ã€‚

å¦‚æœæŠŠ $ s_{i,j}=1 $ çš„ $ i $ å’Œ $ j $ è¿è¾¹ï¼Œä¼¼ä¹å˜æˆäº†ä¸€ä¸ªäºŒåˆ†å›¾åŒ¹é…é—®é¢˜

### Accept

å¯¹äº†ï¼Œç¡®å®æ˜¯ä¸€ä¸ªäºŒåˆ†å›¾é—®é¢˜ï¼Œè¿è¾¹åç›´æ¥æ±‚æœ€å¤§åŒ¹é…ï¼Œè®¨è®ºä¸€ä¸‹ $ s_{n,m} $ çš„å¥‡å¶æ€§å³å¯

```
int n,m;
int a[505][505];
bitset<505> b[505];
void solve(bool SPE){ 
	n=RIN,m=RIN;
	foru(i,1,n){
		foru(j,1,m){
			a[i][j]=RCIN=='B';
		}
	}
	
	foru(i,1,n){
		foru(j,1,m){
			a[i][j]^=a[i+1][j]^a[i][j+1]^a[i+1][j+1];
		}
	}
	
	static vector<int> e[505];
	foru(i,1,n-1){
		if(a[i][m]!=1)	continue;
		foru(j,1,m-1){
			if(a[n][j]!=1)	continue;
			if(a[i][j]){
				e[i]+=j;
			}
		}
	}

	int ver=0;
	static int vis[505];
	static int nto[505];
	static int mto[505];
	int cnt=0;

	auto dfs=[&ver](auto dfs,int u)->bool{
		for(auto v:e[u]){
			if(vis[v]==ver)	continue;
			vis[v]=ver;
			if(mto[v]==0 || dfs(dfs,mto[v])){
				nto[u]=v;
				mto[v]=u;
				return true;
			}
		}
		return false;
	};
	foru(i,1,n){
		if(nto[i]!=0)	continue;
		ver++;
		if(dfs(dfs,i)){
			cnt++;
		}
	}


	int ans=0;

	foru(i,1,n){
		foru(j,1,m){
			ans+=a[i][j];
		}
	}
	ans-=a[n][m];

	ans-=cnt;

	if((cnt&1)!=a[n][m])	ans++;

	cout<<ans;

	return ;
}
```



# P7390

ä½ è¦å¸® djy é€ ä¸€æ£µæ ‘ï¼Œæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

- ç”± $ n $ ä¸ªç‚¹ç»„æˆã€‚

-  $ i $ å·ç‚¹çš„åº¦æ•°ä¸º $ a_i $ ã€‚

å®šä¹‰ä¸€æ¡è¾¹ $ (i,j) $ çš„ä»·å€¼ä¸º $ b_i\times b_j $ ï¼Œä½ è¦åœ¨æ»¡è¶³ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ä¸‹ï¼Œä½¿æ‰€æœ‰è¾¹çš„ä»·å€¼å’Œæœ€å¤§ã€‚

ä¿è¯å­˜åœ¨è¿™æ ·çš„æ ‘ã€‚

å¯¹äº $ 100\% $ çš„æ•°æ®ï¼Œ $ 2\le n\le10^7 $ ï¼Œ $ 1\le a_i\le n $ ï¼Œ $ 1\le b_i\le5\times10^5 $ ï¼Œ $ type\in\{0,1\} $ ï¼Œ $ 0\le seed<2^{31} $ ã€‚

### æ€è€ƒ

æ„Ÿè§‰å¯èƒ½éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œæ¥å‡å°‘å¯èƒ½çš„ç­–ç•¥è¿æ¥æ–¹æ³•

è€ƒè™‘ä¸€ä¸ªä¸€ä¸ªåŠ å…¥ç‚¹ï¼Œå½“å‰çš„ç­–ç•¥åªä¸æ¯ä¸ªç‚¹çš„å‰©ä½™åº¦æ•°æœ‰å…³ï¼Œä¸è¿æ¥æ–¹å¼æ— å…³ã€‚

å¦‚æœæœ‰ $ a\ge b\ge c\ge d $ ï¼Œé‚£ä¹ˆ $ ab+cd\ge ac+bd $ ã€‚è¯æ˜æ˜¾ç„¶ã€‚

æ‰€ä»¥å¯èƒ½å¤§çš„å°½é‡ä¸å¤§çš„è¿æ¥æ˜¯å¥½çš„ï¼Ÿ

è€ƒè™‘æ’åºåä»å¤§åˆ°å°åŠ å…¥ç‚¹ï¼Œç›´æ¥ä¼˜å…ˆä¸è¿˜æœ‰åº¦æ•°çš„æœ€å¤§ç‚¹è¿æ¥ï¼Œæœ‰æ—  hackï¼Ÿ

è¿˜å¾—è€ƒè™‘ 1 åº¦ç‚¹ã€‚ç›´æ¥åˆ†ä¸¤ä¸ªåºåˆ—åŒæŒ‡é’ˆæ’å…¥ã€‚

ç‚¸äº†ï¼Œç­”æ¡ˆåå°ã€‚

### é¢˜è§£

åˆšæ‰çš„åˆ¤æ–­æ˜¯å¯¹çš„ï¼Œå°½é‡è®©å¤§çš„ä¸å¤§çš„è¿æ˜¯å®Œå…¨æ²¡é—®é¢˜çš„ï¼Œé—®é¢˜åœ¨äºæ„é€ æ–¹å¼å‡ºç°é—®é¢˜ã€‚åŸæ¥é‚£æ ·æ„é€ ï¼Œåœ¨å½“å‰è”é€šå—åªå‰©ä¸‹ $ 1 $ åº¦çš„æ—¶å€™ï¼Œå¼ºè¡Œé’¦å®šå…¶ä¸ä¸‹ä¸€ä¸ªéå¶ç‚¹è¿è¾¹ï¼Œè€Œè¿™æ˜¯ä¸å¯¹çš„ï¼Œåœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œè¿™ä¸ªè”é€šå—ä¸åˆ«çš„æ‰€æœ‰å¶å­æ˜¯ç­‰ä»·çš„ï¼Œå¿…é¡»ä»æ‰€æœ‰"å¶å­" é‡ŒæŒ‘ä¸€ä¸ªä¸ä¸‹ä¸ªéå¶ç‚¹è¿è¾¹ã€‚

å› æ­¤åœ¨æ¯ä¸ªè”é€šå—å°è¯•æ‹“å±•æ—¶åˆ¤æ–­ï¼Œå¦‚æœè¿™ä¸ªè”é€šå—å˜æˆå¶å­äº†å°±ä¸ä¸ä¸‹ä¸ªéå¶ç‚¹è¿è¾¹ï¼Œè€Œæ˜¯åŠ å…¥å¶å­çš„æ•°æ®ç»“æ„ã€‚

ä¸€å¼€å§‹çš„å¶å­æ˜¯å•è°ƒé€’å‡çš„ï¼Œéšç€ç®—æ³•è¿›è¡Œæ–°å¢çš„å¶å­ä¹Ÿæ˜¯å•è°ƒé€’å‡çš„ï¼Œä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—ç»´æŠ¤å³å¯åšåˆ°çº¿æ€§ï¼Œé¿å…ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ã€‚

```
int n;
class Node{
public:
	int a,b;
}a[10000005],lf[10000005];
int rf[10000005];
int N,M;
unsigned seed;
unsigned rnd(unsigned x){
	x^=x<<13;
	x^=x>>17;
	x^=x<<5;
	return x;
}
int rad(int x,int y){
	seed=rnd(seed);
	return seed%(y-x+1)+x;
}
void init_data(){
	cin>>seed;
	for(int i=1;i<=n;i++)
		a[i].a=1,a[i].b=rad(1,500000);
	for(int i=1;i<=n-2;i++)
		a[rad(1,n)].a++;
}



void solve(bool SPE){ 
	int type=RIN;
	n=RIN;
	if(type==0){
		foru(i,1,n){
			a[i].a=RIN;
		}
		foru(i,1,n){
			a[i].b=RIN;
		}
	}else{
		init_data();
	}

	sort(a+1,a+1+n,[](const Node& x,const Node& y)->bool{
		return x.b>y.b;
	});


	class LEAF{
	public:
		queue<int> q;
		queue<int> qn;
		void pushsrc(int x){
			q.push(x);
		}
		void push(int x){
			qn.push(x);
		}
		bool empty(){
			return q.empty() && qn.empty();
		}
		int get(){
			if(q.empty())	return qn.front();
			if(qn.empty())	return q.front();
			if(q.front()>qn.front()){
				return q.front();
			}else{
				return qn.front();
			}
		}
		void pop(){
			if(q.empty()){
				qn.pop();
				return ;
			}
			if(qn.empty()){
				q.pop();
				return ;
			}
			if(q.front()>qn.front()){
				q.pop();
			}else{
				qn.pop();
			}
		}
		int size(){
			return q.size()+qn.size();
		}
	}leaf;

	foru(i,1,n){
		if(a[i].a==1){
			leaf.pushsrc(a[i].b);
			// rf[++M]=a[i].b;
		}else{
			lf[++N]=a[i];
		}
	}

	LL ans=0;
	
	int l=1;
	// int ptr=0;

	foru(r,1,N){
		// cerr<<"r "<<r<<endl;
		auto check=[&]()->bool{
			return l==r && lf[l].a==1;
		};
		auto us=[&]()->void{
			lf[l].a--;
			if(lf[l].a==0)	l++;
		};
		while(!check() && !leaf.empty() && (r==N || leaf.get()>lf[r+1].b)){
			// cerr<<lf[l].b<<' '<<leaf.get()<<endl;
			ans+=(LL)lf[l].b*leaf.get();
			leaf.pop();
			us();
		}
		if(r==N){
			ast(check());
		}
		if(!check()){
			// cerr<<lf[l].b<<'~'<<lf[r+1].b<<endl;
			ans+=(LL)lf[l].b*lf[r+1].b;
			us();
			lf[r+1].a--;
		}else{
			leaf.push(lf[l].b);
			l=r+1;
		}
	}

	ast(leaf.size()==2);
	LL V=leaf.get();
	leaf.pop();
	ans+=leaf.get()*V;

	// foru(i,1,n){
	// 	cerr<<a[i].a<<' '<<a[i].b<<endl;
	// }

	cout<<ans;

	return ;
}
```



# CF1870E

ç»™ä½ ä¸€ä¸ªåºåˆ— $ a $ ï¼Œè®©ä½ é€‰å‡ºä¸€äº›ä¸äº¤çš„å­æ®µï¼Œä½¿å¾—å®ƒä»¬çš„ MEX çš„å¼‚æˆ–å’Œæœ€å¤§ã€‚

 $ 1\le n\le 5000ï¼Œ0\le a_i\le n $ 

### æ€è€ƒ

èƒ½å¦ç›´æ¥ DPã€‚ $ f_{i,j} $ è¡¨ç¤ºé’¦å®š $ i $ å±äºæœ€åä¸€ä¸ªå­æ®µï¼Œè€ƒè™‘äº†å‰ $ i $ ä¸ªå…ƒç´ ï¼Œæœ€å¤§çš„ç­”æ¡ˆã€‚è½¬ç§»æšä¸¾æœ€åä¸€ä¸ªåºåˆ—é•¿åº¦ï¼š
$$
f_{i,j}\leftarrow \bigvee_{k=1}^i\bigvee_{p=0}^{i-k}f_{p,j\oplus \operatorname{mex}(i-k+1,i)}
$$
ä¸‹æ ‡åŒæ—¶ä¸ $ i,j,k $ æœ‰å…³ï¼Œéš¾ä»¥ä¼˜åŒ–ï¼Œåº”è¯¥å¯»æ‰¾æ€§è´¨ã€‚

æœ‰ç”¨çš„åŒºé—´å¹¶ä¸å¤šï¼Ÿå¯¹äºæ¯ä¸ª mex çš„"æç´§"åŒºé—´æ˜¯æœ‰é™çš„

æœ‰æ•ˆåŒºé—´æ•°é‡åº”è¯¥æ˜¯
$$
\sum_iå› ä¸ºåŠ å…¥\ a_i\ å¯¼è‡´\ \operatorname{mex}\ å‘ç”Ÿæ”¹å˜çš„åŒºé—´æ•°é‡
$$
 ç›´æ¥åšä¸€ä¸‹çœ‹çœ‹

å»æ‰æ‰€æœ‰è¢«æ”¯é…çš„åŒºé—´

### Accept

å»æ‰å°±è¿‡äº†ã€‚

å½¢å¼åŒ–åœ°ï¼Œä¸€ä¸ªåŒºé—´ $ [l,r] $ æ˜¯æœ‰æ•ˆè½¬ç§»åŒºé—´ï¼Œå½“ä¸”ä»…å½“ä¸å­˜åœ¨ä¸€ä¸ª $ [l',r']\in[l,r]\and[l',r']\neq[l,r] $ ï¼Œæ»¡è¶³ $ \operatorname{mex}(l,r)=\operatorname{mex}(l',r') $ ã€‚

å¯ä»¥è¯æ˜ï¼Œè¿™æ ·çš„åŒºé—´ä¸ªæ•°ä¸º $ O(n) $ ã€‚

ä»¤æ¯ä¸ªæœ‰æ•ˆåŒºé—´åœ¨è¾ƒå¤§çš„ç«¯ç‚¹ä¸€ä¾§è¢«ç»Ÿè®¡ã€‚æ˜¾ç„¶ä¸€ä¸ªæœ‰æ•ˆåŒºé—´çš„ç«¯ç‚¹ä¸å¯èƒ½ç›¸ç­‰ï¼Œé™¤äº† $ [i,i] $ è¿™æ ·çš„åŒºé—´ã€‚ä¸è¿‡å®ƒä»¬æœ¬æ¥å°±åªæœ‰ $ n $ ä¸ªã€‚

è€ƒè™‘ä»¥ $ i $ ä¸ºå·¦ç«¯ç‚¹çš„æœ‰æ•ˆåŒºé—´ä¸ªæ•°ï¼Œæ ¹æ®åˆšæ‰çš„ç»Ÿè®¡åŸåˆ™ï¼Œæ‰€æœ‰ç¬¦åˆè¦æ±‚çš„æœ‰æ•ˆåŒºé—´çš„å³ç«¯ç‚¹éƒ½åº”è¯¥å°äº $ a_i $ ã€‚å› æ­¤æ˜¾ç„¶è¿™äº›æœ‰æ•ˆåŒºé—´çš„ $ \operatorname{mex} $ ä¸å¯èƒ½å¤§äº $ a_i+1 $ ã€‚è€Œ $ \operatorname{mex} $ ä¹Ÿä¸å¯èƒ½å°äº $ a_i $ ï¼Œå› ä¸ºè¿™æ„å‘³ç€ $ a_i $ æ˜¯æ— ç”¨çš„ï¼Œåº”è¯¥è¢«è¸¢å‡ºåŒºé—´ã€‚ç»¼ä¸Šï¼Œç¬¦åˆè¦æ±‚çš„æœ‰æ•ˆåŒºé—´çš„ $ \operatorname{mex} $ ä¸€å®šä¸º $ a_i+1 $ ã€‚æ˜¾ç„¶è¿™æ ·çš„åŒºé—´æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªã€‚

ä»¥ $ i $ ä¸ºå³ç«¯ç‚¹çš„åˆ†æåŒç†ã€‚äºæ˜¯æ€»æœ‰æ•ˆè½¬ç§»æ•°é‡å°±æ˜¯ $ O(n) $ çš„äº†ã€‚

```
int n;
int a[5005];

int fa[5005],sz[5005];
int find(int x){
	// cerr<<x<<' '<<fa[x]endl;
	return fa[x]==x?x:fa[x]=find(fa[x]);
}
void Union(int x,int y){
	x=find(x),y=find(y);
	if(x==y)	return ;
	fa[x]=y;
	sz[y]+=sz[x];
}

void solve(bool SPE){ 
	n=RIN;

	foru(i,1,n){
		a[i]=RIN;
	}

	static int mex[5005][5005];
	foru(i,1,n){
		foru(j,0,n+1){
			fa[j]=j;
			sz[j]=1;
		}
		for(int l=i;l>=1;l--){
			Union(a[l],a[l]+1);
			mex[l][i]=sz[find(0)]-1;
			// cerr<<l<<' '<<i<<' '<<mex[l][i]<<endl;
		}
	}

	static int lf[5005][5005];
	foru(i,0,n){
		foru(j,0,n){
			lf[i][j]=0;
		}
	}

	static bitset<9000> f[5005];

	f[0].reset();
	f[0][0]=1;

	foru(i,1,n){
		f[i]=f[i-1];
		ford(l,i,1){
			if(l<i && mex[l][i]==mex[l+1][i])	continue;
			lf[i][mex[l][i]]=l;
			if(lf[i-1][mex[l][i]]==l)	continue;
			// cerr<<'	'<<l<<' '<<i<<' '<<mex[l][i]<<endl;
			for(int j=f[l-1]._Find_first();j<=8192;j=f[l-1]._Find_next(j)){
				// cerr<<
				f[i][j^mex[l][i]]=1;
			}
		}
	}

	int ans=0;
	foru(i,0,8192){
		if(f[n][i]){
			ans=i;
		}
	}

	cout<<ans<<'\n';

	return ;
}
```



# agc012_e

åœ¨æ•°è½´ä¸Šæœ‰ $ N $ ä¸ªç»¿æ´²ã€‚ä»å·¦è¾¹æ•°ç¬¬ $ i $ ä¸ªç»¿æ´²çš„åæ ‡æ˜¯ $ x _ i $ ã€‚

éª†é©¼å¸Œæœ›è®¿é—®æ‰€æœ‰è¿™äº›ç»¿æ´²ã€‚æœ€åˆï¼Œä»–èƒŒä¸Šé©¼å³°çš„å®¹ç§¯ä¸º $ V $ ã€‚å½“é©¼å³°çš„å®¹ç§¯ä¸º $ v $ æ—¶ï¼Œæœ€å¤šå¯ä»¥å­˜å‚¨ä½“ç§¯ä¸º $ v $ çš„æ°´ã€‚æ°´åªåœ¨ç»¿æ´²å¤„ä¾›ç»™ã€‚ä»–å¯ä»¥åœ¨ä¸€ä¸ªç»¿æ´²è·å¾—å°½å¯èƒ½å¤šçš„æ°´ï¼Œå¹¶ä¸”åŒä¸€ä¸ªç»¿æ´²å¯ä»¥ä½¿ç”¨ä»»æ„æ¬¡æ•°ã€‚

éª†é©¼å¯ä»¥é€šè¿‡æ­¥è¡Œæˆ–è·³è·ƒåœ¨æ•°è½´ä¸Šç§»åŠ¨ï¼š

-   æ­¥è¡Œè·ç¦»ä¸º $ d $ éœ€è¦ä»é©¼å³°æ¶ˆè€—ä½“ç§¯ä¸º $ d $ çš„æ°´ã€‚æ— æ³•è¿›è¡Œå¯¼è‡´å­˜å‚¨æ°´é‡ä¸ºè´Ÿçš„æ­¥è¡Œã€‚
-   ä»¤ $ v $ ä¸ºå½“å‰å­˜å‚¨çš„æ°´é‡ã€‚å½“ $ v\gt 0 $ æ—¶ï¼Œéª†é©¼å¯ä»¥è·³åˆ°ä»–é€‰æ‹©çš„æ•°è½´ä¸Šçš„ä»»æ„ç‚¹ã€‚æ­¤ä¸¾ä¹‹åï¼Œé©¼å³°çš„å®¹é‡å˜ä¸º $ v/2 $ (å‘ä¸‹å–æ•´åˆ°æœ€æ¥è¿‘çš„æ•´æ•°)ï¼Œå­˜å‚¨çš„æ°´é‡å˜ä¸º $ 0 $ ã€‚

å¯¹äºæ¯ä¸ªç»¿æ´²ï¼Œç¡®å®šæ˜¯å¦å¯ä»¥ä»è¯¥ç»¿æ´²å‡ºå‘è®¿é—®æ‰€æœ‰ç»¿æ´²ã€‚

-    $ 2 \le N,V \le 2 \times 10^5 $ 
-    $ -10^9 \le x_1 \lt x_2 \lt ... \lt x_N \le 10^9 $ 
-    $ V $ and $ x_i $ are all integers.

### æ€è€ƒ

å¯¹äºå½“å‰æ‰€å¤„çš„ç»¿æ´²ï¼Œè‚¯å®šåˆ©ç”¨ $ V $ å…¨éƒ¨èµ°å®Œé‚»è¿‘çš„æ‰€æœ‰ç»¿æ´²ï¼Œç›´åˆ°æ’ä¸Šä¸€ä¸ªé•¿åº¦è¶…è¿‡ $ V $ çš„é—´éš”ã€‚

è·³è·ƒåä¹Ÿä¼šèµ°å®Œ "ä¸€ä¸ªè”é€šå—"

æ³¨æ„åˆ°è¿™äº›è”é€šå—æ„æˆäº†ä¸€ä¸ªæ ‘å½¢ç»“æ„çŠ¶ç‰©ã€‚æ¯å±‚æ‹¥æœ‰ç›¸åŒçš„ $ V $ ï¼Œæ ‘é«˜æ˜¯ $ \log V $ çš„ã€‚

åœ¨é«˜å±‚ï¼ˆ $ V $ è¾ƒå¤§ï¼‰æ–­å¼€çš„é—´éš™ï¼Œåº•å±‚ä¹Ÿä¼šæ–­å¼€ã€‚

æœ€é«˜å±‚çš„æ¯ä¸ªå—å¯ä»¥ç‹¬ç«‹åšã€‚

æ¯ä¸ªè¯¢é—®äºæ˜¯å½¢å¦‚ï¼Œé’¦å®šæœ€é«˜å±‚çš„ä¸€æ®µå¿…é€‰ï¼Œæ˜¯å¦å­˜åœ¨ä¸€ä¸ªåœ¨ä¸‹å±‚æ¯å±‚é€‰å‡ºä¸€ä¸ªè”é€šå—çš„æ–¹æ¡ˆï¼Œä½¿å¾—ä»–ä»¬èƒ½æ‹¼å‡ºæ•´ä¸ªåºåˆ—ã€‚

æˆ–è®¸å¯ä»¥æšä¸¾æœ€é«˜å±‚çš„æ®µï¼Œç”¨å‰åçš„ç­”æ¡ˆæ‹¼èµ·æ¥ã€‚éœ€è¦è§£å†³çš„æ˜¯ï¼Œå¯¹äºä¸€ä¸ªå‰ç¼€ï¼Œåœ¨æ¯å±‚ï¼ˆé™¤å»æœ€é«˜å±‚ï¼‰é€‰ä¸€ä¸ªè”é€šå—ï¼Œèƒ½å¦æ‹¼å‡ºæ•´ä¸ªå‰ç¼€ã€‚

ä¼¼ä¹ä¸å¯è¡Œï¼Œä¸èƒ½ä¿è¯å‰åå±‚æ•°æ— äº¤ã€‚

å‰Šå¼±è¯¢é—®ï¼Œè€ƒè™‘ä»»æ„èµ·ç‚¹æ€ä¹ˆåšã€‚

å¯ä»¥æšä¸¾æœ€é«˜å±‚é€‰å“ªä¸ªï¼Œç„¶åè½¬å˜ä¸ºäº†ä¸€ä¸ªå­é—®é¢˜ã€‚

ä½†è¿™ä¸ªå­é—®é¢˜éœ€è¦æ’é™¤æ‰æœ€é«˜å±‚é€‰çš„è¿™ä¸ªèŒƒå›´ã€‚é‡æ–°è®¡ç®—çš„å¤æ‚åº¦åº”è¯¥æ˜¯ä¸å¯æ¥å—çš„ï¼Œä½†å‰åæ‹¼æ¥ä¼¼ä¹ä¹Ÿå¾ˆå›°éš¾ã€‚

å‰åæ‹¼æ¥åº”è¯¥æ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºä¸‹é¢æ¯å±‚éƒ½ä¼šå—åˆ°è¿™æ¬¡å†³ç­–çš„å½±å“ï¼Ÿ

è€ƒè™‘èƒ½å¦è½¬åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œä¾‹å¦‚åˆå¹¶ï¼Œåˆ†è£‚å±‚è”é€šå—ã€‚ä¼¼ä¹ä¸è¡Œã€‚

### é¢˜è§£

çœ‹ä¼¼ä¸èƒ½çŠ¶å‹ï¼Œæ°æ°ç›¸åï¼Œå°±å¾—çŠ¶å‹

è§‰å¾—ä¸èƒ½çŠ¶å‹æ˜¯å› ä¸ºè¯•å›¾åšå½¢å¦‚ $ f_{i,s} $ è¿™æ ·çš„ DPï¼Œè¡¨ç¤ºæŸç§æ„ä¹‰çš„å‰ç¼€èƒ½å¦ç”¨é›†åˆ $ s $ å®Œå…¨è¦†ç›–ï¼Œç”¨å‰åç¼€æ‹¼èµ·æ¥å¾—åˆ°ç­”æ¡ˆã€‚è¿™æ ·ç¬¬äºŒç»´åº¦æ˜¯ $ O(V) $ çš„ï¼Œç¬¬ä¸€ç»´åº¦ä¼¼ä¹ä¹Ÿä¸å°ç›´æ¥çˆ†ç‚¸ï¼Œè€Œä¸”æ ¹æœ¬æ²¡æ³•è½¬ç§»ã€‚

ç„¶è€Œè¿™ä¸ª DP è ¢çš„æ²¡è¾¹äº†ã€‚è¿™æ˜¯ä¸ªå¯è¡Œæ€§ DPï¼Œè€ƒè™‘å¯¹äºç›¸åŒçš„ $ s $ ï¼Œä¸€å®šæœ‰ä¸€ä¸ªå‰ç¼€ $ f $ ä¸º $ 1 $ ï¼Œåç¼€ä¸º $ 0 $ ã€‚æˆ‘ä»¬åªéœ€è¦é‚£ä¸ªåˆ†ç•Œçº¿çš„ä½ç½®ï¼Œä¸éœ€è¦å…·ä½“è®°å½•æ¯ä¸ªä½ç½®æ˜¯ $ 0 $ è¿˜æ˜¯ $ 1 $ ã€‚æ˜¯è¿™ä¸ªå¯äºŒåˆ†çš„æ€§è´¨è®©æˆ‘ä»¬å¯ä»¥çœå»ç¬¬ä¸€ç»´åº¦ã€‚

> å“ªæ€•åœ¨ç±»åºåˆ—ä¸ŠçŠ¶å‹ DPï¼Œä¹Ÿæœ‰å¯èƒ½åªä»¥é›†åˆä½œä¸ºä¸‹æ ‡
>
> è§‚å¯Ÿ DP çš„ä¿¡æ¯ï¼Œå’Œæˆ‘ä»¬ä½¿ç”¨çš„ä¿¡æ¯ã€‚å¦‚æœä½¿ç”¨çš„ä¿¡æ¯å°ï¼ŒDP çš„ä¿¡æ¯å¤šï¼Œä¸” DP çš„ä¿¡æ¯å…·æœ‰æŸç§æ€§è´¨ï¼Œå¯ä»¥å‹ç¼© DPï¼Œä½¿å¾—å¯¹äºçŠ¶æ€ç©ºé—´çš„åˆ’åˆ†æ›´å°‘ã€‚
>
> å¯¹äºæ­¤é¢˜ï¼ŒDP ç»´æŠ¤äº†ä¸€å¤§å † 0 1ï¼Œä½†å…·æœ‰å‰ç¼€ $ 1 $ åç¼€ $ 0 $ çš„æ€§è´¨ã€‚å› æ­¤åªç»´æŠ¤ä¸€ä¸ªåˆ†ç•Œç‚¹ï¼Œè€Œä¸æ˜¯ç»´æŠ¤æ‰€æœ‰ 01 æ˜¯æ­£ç¡®çš„ã€‚

äºæ˜¯ç”¨è„šåšå°±è¡Œäº†ã€‚

# CF1984F


ä¸¤åªé¥¥é¥¿çš„å°ç†ŠçŒ«å¥¥æ–¯å¡å’Œéœ²æ‹‰ï¼Œæœ‰ä¸€æ£µå…·æœ‰ $ n $ ä¸ªèŠ‚ç‚¹çš„æ ‘ $ T $ ã€‚ä»–ä»¬æ„¿æ„å¯¹æ•´æ£µæ ‘ $ T $ æ‰§è¡Œä»¥ä¸‹**æ´—ç‰Œè¿‡ç¨‹**ï¼Œ**ä»…ä¸€æ¬¡**ã€‚é€šè¿‡è¿™ä¸ªæ´—ç‰Œè¿‡ç¨‹ï¼Œä»–ä»¬å°†ä»æ—§æ ‘çš„èŠ‚ç‚¹åˆ›å»ºä¸€æ£µæ–°æ ‘ã€‚

1.  ä»åŸå§‹æ ‘ $ T $ ä¸­é€‰æ‹©ä»»æ„èŠ‚ç‚¹ $ V $ ã€‚åˆ›å»ºä¸€æ£µä»¥ $ V $ ä¸ºæ ¹çš„æ–°æ ‘ $ T_2 $ ã€‚
2.  ä» $ T $ ä¸­ç§»é™¤ $ V $ ï¼Œä½¿å¾—åŸå§‹æ ‘åˆ†è£‚æˆä¸€ä¸ªæˆ–å¤šä¸ªå­æ ‘ï¼ˆå¦‚æœ $ V $ æ˜¯ $ T $ ä¸­å”¯ä¸€çš„èŠ‚ç‚¹ï¼Œåˆ™ä¸ºé›¶ä¸ªå­æ ‘ï¼‰ã€‚
3.  å¯¹æ¯ä¸ªå­æ ‘ä½¿ç”¨ç›¸åŒçš„è¿‡ç¨‹è¿›è¡Œæ´—ç‰Œï¼ˆå†æ¬¡é€‰æ‹©ä»»æ„èŠ‚ç‚¹ä½œä¸ºæ ¹ï¼‰ï¼Œç„¶åå°†æ‰€æœ‰æ´—ç‰Œåçš„å­æ ‘çš„æ ¹è¿æ¥å› $ V $ ï¼Œå®Œæˆæ„å»º $ T_2 $ ã€‚

ä¹‹åï¼Œå¥¥æ–¯å¡å’Œéœ²æ‹‰ç•™ä¸‹ä¸€æ£µæ–°æ ‘ $ T_2 $ ã€‚ä»–ä»¬åªèƒ½åƒå¶å­ï¼Œéå¸¸é¥¥é¥¿ï¼Œè¯·æ‰¾å‡º**ä»…ä¸€æ¬¡**æ´—ç‰Œè¿‡ç¨‹ä¸­å¯ä»¥åˆ›å»ºçš„æ‰€æœ‰æ ‘ä¸­å¶å­çš„æœ€å¤§æ•°é‡ã€‚

æ³¨æ„ï¼Œå¶å­æ˜¯æ‰€æœ‰åº¦ä¸º $ 1 $ çš„èŠ‚ç‚¹ã€‚å› æ­¤ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™æ ¹èŠ‚ç‚¹å¯ä»¥è¢«è§†ä¸ºå¶å­ã€‚

$n\le 2\times 10^5$

### æ€è€ƒ

ææ ¹å¾ˆæŠ½è±¡ã€‚

æè”é€šå—çš„è¿‡ç¨‹ç›¸å½“äºï¼Œç»™è¿æ¥ç‚¹åº¦æ•°å‡ä¸€ï¼Œå†æŠŠæ–°æ ¹åº¦æ•°åŠ ä¸€ã€‚

è¦æœ€å¤§åŒ–åº¦æ•°ä¸ºä¸€çš„æ•°é‡ã€‚

äºæ˜¯å¯ä»¥è¿™æ ·è½¬åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼š



å¯¹äºä¸€ä¸ªè”é€šå—

- é€‰ä¸€ä¸ªåˆå§‹ç‚¹ï¼ŒæŠŠå®ƒçš„åº¦æ•°åŠ ä¸€ï¼ŒæŠŠå®ƒå‘¨å›´çš„ã€**è”é€šå—å†…**çš„ç‚¹çš„åº¦æ•°å‡ä¸€
- å¯¹äºæ¯ä¸ªè£‚å‡ºæ¥çš„è”é€šå—ï¼Œåšç›¸åŒç®—æ³•



æœ€åæšä¸¾ä¸€ä¸ªå…¨å±€çš„æ ¹ï¼Œå®ƒçš„åº¦æ•°ä¸åŠ ä¸€ï¼Œå¯¹ä»–çš„æ¯ä¸ªå­æ ‘éƒ½åšä¸Šé¢çš„ç®—æ³•ï¼Œæœ€åå°±èƒ½å¾—åˆ°æ¯ä¸ªç‚¹çš„åº¦æ•°ï¼Œè€Œä¸éœ€è¦çœŸçš„æ—‹è½¬æ ‘ç»“æ„

è¿™ä¸ªè¿‡ç¨‹æ˜¯å¯æ‰“ä¹±é¡ºåºæ¥ DP çš„ã€‚

è€ƒè™‘æ¯ä¸€æ¡è¾¹ $(u,v)$ï¼Œæˆ‘ä»¬çŸ¥é“ $u,v$ éƒ½ä¼šè¢«æ“ä½œï¼Œä½†åªæœ‰æ“ä½œæ›´æ™šçš„é‚£ä¸ªæ‰ä¼šè¢«åº¦æ•°å‡ä¸€ã€‚

æ¢è¨€ä¹‹ï¼Œå¯¹äºæ¯æ¡è¾¹ï¼Œæˆ‘ä»¬åªå…³å¿ƒäºŒè€…çš„ç›¸å¯¹æ“ä½œæ—©æ™šï¼Œæ®æ­¤å°±èƒ½çŸ¥é“ $-1$ çš„èµ°å‘ã€‚è¿™ç›¸å½“äºç»™æ— å‘è¾¹å®šå‘ã€‚åŒæ—¶å®¹æ˜“æ„é€ ä¸€ä¸ªå…·ä½“çš„æ“ä½œåºåˆ—ï¼Œå¯¹äºå®šå‘åçš„æœ‰å‘å›¾æ‹“æ‰‘æ’åºå³å¯ã€‚

è®¾ $f_{i,0/1}$ è¡¨ç¤ºåªè€ƒè™‘ $i$ æ‰€åœ¨çš„å­æ ‘ï¼Œ$i$ å’Œå®ƒçš„çˆ¶äº²å“ªä¸ªæ“ä½œæ›´æ—©ï¼Œèƒ½å¾—åˆ°çš„åº¦æ•°ä¸º $1$ çš„èŠ‚ç‚¹çš„æœ€å¤šæ•°é‡ã€‚ç­”æ¡ˆå¯ä»¥æ¢æ ¹ DP è®¡ç®—ã€‚

è€ƒè™‘å¦‚ä½•è½¬ç§»ï¼Œå‘ç°ä¹Ÿæ˜¯ç®€å•çš„ã€‚$u$ æƒ³è¦å˜æˆåº¦æ•°ä¸º $1$ï¼Œå¿…é¡»æ‰€æœ‰ä¸ä¹‹ç›¸è¿çš„è¾¹éƒ½å‘å®ƒè´¡çŒ® $-1$ï¼Œè½¬ç§»å›ºå®šã€‚å¦‚æœ $u$ ä¸æƒ³å˜æˆå¶å­ï¼Œåˆ™å–æ¯ä¸ªå­©å­çš„ $\max(f_{v,0},f_{v,1})$ å³å¯ã€‚æ€»å¤æ‚åº¦ $O(n)$ã€‚

### Accept

è¿‡äº†ï¼Œè¿™æ€è·¯å¯¹çš„ä¸èƒ½å†å¯¹äº†ï¼Œæ»¡æ˜ğŸ˜‹ï¸

```
int n;
vector<int> e[MAXN];
void solve(bool SPE){ 
    n=RIN;
    foru(i,1,n){
        e[i].clear();
    }
    foru(i,1,n-1){
        int u=RIN,v=RIN;
        e[u]+=v;
        e[v]+=u;
    }

    static int f[MAXN][2];
	static int fa[MAXN];

    auto dfs=[](auto dfs,int u,int fath)->void {
		fa[u]=fath;
        for(auto v:e[u]){
            if(v==fa[u])	continue;
			dfs(dfs,v,u);
        }
		
		f[u][0]=1;
		f[u][1]=0;
		for(auto v:e[u]){
			if(v==fa[u])	continue;
			f[u][0]+=f[v][1];
			f[u][1]+=max(f[v][0],f[v][1]);
		}
		chkmax(f[u][0],f[u][1]);
    };

	dfs(dfs,1,0);

	int ans=0;

	auto calc=[&ans](auto calc,int u,array<int,2> F)->void {
		int sum=F[0];
		for(auto v:e[u]){
			if(v==fa[u])	continue;
			sum+=f[v][0];
		}
		chkmax(ans,sum+((int)e[u].size()==1));

		// if(u==3){
		// 	cerr<<F[0]<<' '<<F[1]<<endl;
		// }

		array<int,2> g{1,0};
		g[0]+=F[1];
		g[1]+=max(F[0],F[1]);

		for(auto v:e[u]){
			if(v==fa[u])	continue;
			g[0]+=f[v][1];
			g[1]+=max(f[v][0],f[v][1]);
		}

		for(auto v:e[u]){
			if(v==fa[u])	continue;
			calc(calc,v,array<int,2>{max(g[0]-f[v][1],g[1]-max(f[v][0],f[v][1])),g[1]-max(f[v][0],f[v][1])});
		}
	};

	// cerr<<f[2][1]<<endl;

	calc(calc,1,array<int,2>{0,0});

	cout<<ans<<'\n';

	// exit(0);

	return ;
}
```

